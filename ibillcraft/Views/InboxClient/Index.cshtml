@using Microsoft.AspNetCore.Mvc.Localization;
@using Microsoft.Extensions.Localization;
@using System.Globalization;
@inject IViewLocalizer Localizer;
@model IEnumerable<ibillcraft.Models.InboxClientModel>
@{

    ViewData["Title"] = "";
    ViewBag.Header = "";

    Layout = "~/Views/Shared/_Layout.cshtml";


}


<style>
    * {
        box-sizing: border-box;
    }

    .flex-container {
        display: flex;
        width: 100%;
        gap: 10px;
    }

    .box {
        padding: 15px;
        border: 1px solid;
    }

        .box:first-child {
            flex: 2; /* First box will take twice the space compared to the second */
        }

        .box:nth-child(2) {
            flex: 1; /* Second box will take normal space */
        }

    .buttons {
        margin-top: 20px;
        padding-left: 40%;
    }

    .attachments, .conversation {
        margin-top: 20px;
    }


    .modal-body {
        background-color: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
    }

    .box {
        background-color: #ffffff;
        border: 1px solid #ddd;
        box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);
        margin-bottom: 15px;
        padding: 15px;
    }

    .form-group label {
        font-size: larger;
        font-weight: bold;
    }

    .form-group textarea {
        width: 100%;
        font-size: medium;
        resize: none;
    }

    .attachments table,
    .conversation table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }

    .attachments th,
    .conversation th {
        text-align: left;
        padding: 10px;
        font-size: larger;
        font-weight: bold;
        border: 1px solid #ddd;
    }

    .attachments td,
    .conversation td {
        padding: 8px;
        border: 1px solid #ddd;
    }



    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f4f4f4;
    }

    .container {
        width: 60%;
        margin: 20px auto;
        background: white;
        padding: 20px;
        border: 1px solid #ccc;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 20px;
    }

    .date {
        font-size: 14px;
        color: #555;
    }

    .subject {
        font-weight: bold;
        font-size: 18px;
        margin-bottom: 20px;
    }

    .content {
        line-height: 1.6;
        color: #333;
    }

    ul {
        margin: 10px 0;
        padding-left: 20px;
    }

    .footer {
        margin-top: 20px;
    }

    .button {
        margin-top: 20px;
        text-align: center;
    }

        .button a {
            display: inline-block;
            padding: 10px 20px;
            background-color: #5a67d8;
            color: white;
            text-decoration: none;
            font-size: 16px;
            border-radius: 4px;
        }

    .email-info {
        font-size: 14px;
        color: #555;
        margin-bottom: 10px;
    }



    /* arrow */
    .arrow-container {
        background-color: #4a4747;
        padding: 10px;
        width: 100px;
        color: white;
        font-family: Arial, sans-serif;
    }

    .arrow-item {
        background-color: #d3d3d3;
        color: black;
        padding: 4px;
        position: relative;
        margin-bottom: 15px;
        font-size: 14px;
        text-align: center;
        border-radius: 3px;
    }

        .arrow-item::after {
            content: '';
            position: absolute;
            top: 53%;
            right: -26px;
            transform: translateY(-50%);
            border-width: 14px;
            border-style: solid;
            border-color: transparent transparent transparent #d3d3d3;
        }
</style>

<div class="card shadow mb-4">
    <div class="card-header py-3">
        <div class="row align-items-center">
            <div class="col">
                <h2 class="m-0 font-weight-bold text-primary">@Localizer["Email Inbox"]</h2>
            </div>
            <div class="col-lg-1 col-md-1 " style="display:none">
                <label for="name" class="form-label float-lg-end">@Localizer["Client Name"]:</label>
            </div>
            <div class="col-lg-2 col-md-2" style="display:none">
                <select id="clientDropdown" class="form-select" placeholder="select type" asp-items="@(new SelectList(ViewBag.customer,"Id","Value"))" onchange="return clientchange()">
                    <option value="">--Select--</option>
                </select>
            </div>
            <div class="col-lg-2 col-md-2">
                @*     <a class="btn btn-md text-light float-end bg-success mt-3 mt-lg-0 mt-md-0 ml-2" asp-action="Index" asp-controller="InboxEmail" *@
                <a class="btn btn-md text-light float-end bg-success mt-3 mt-lg-0 mt-md-0 ml-2" asp-action="Index" asp-controller="InboxEmail"
                   title="Back" type="button">
                    <i class="fa fa-angle-left" style="font-size:24px"></i>
                </a>

            </div>
            <div class="col-md-2 justify-content-lg-end justify-content-md-end justify-content-center mt-lg-0 mt-md-0 mt-3">
                <input type="text" id="custom-search" class="form-control" placeholder="@Localizer["Search"]" />
            </div>

        </div>
    </div>

    <div class="card-body">
        <div class="table-responsive" id="print" style="display:none">
            <table class="table table-bordered" id="dataTable1" width="100%" cellspacing="0">
                <thead>
                    <tr>
                        <th width="6%">@Localizer["Sr.No"]</th>
                        <th style="display:none">from</th>
                        <th style="display:none">fromemail</th>
                        <th>@Localizer["Year"]</th>
                        <th>@Localizer["Count"]</th>
                    </tr>
                </thead>
                <tbody id="tbodyid">
                    @{
                        int itemNumber = 1;
                    }
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td>@itemNumber</td>
                            <td style="display:none"> @Html.DisplayFor(modelItem => item.ic_from)</td>
                            <td style="display:none"> @Html.DisplayFor(modelItem => item.ic_fromname)</td>
                            <td onclick="show('@item.ic_year.Substring(0, 4)', '@item.ic_fromname', '@item.ic_from','enquiry')">
                                @Html.DisplayFor(modelItem => item.ic_year)
                            </td>

                            <td>
                                @Html.DisplayFor(modelItem => item.ic_count)
                            </td>
                        </tr>
                        itemNumber++;
                    }
                </tbody>
            </table>


        </div>

        <div class="card-header py-3" style="display:none" id="detailsgridname">
            <div class="row align-items-center">
                <div class="col-lg-1 col-md-1 ">
                    <label for="name" class="form-label float-lg-end">@Localizer["Client Name"]:</label>
                </div>
                <div class="col-lg-2 col-md-2">
                    <select id="clientDropdown1" class="form-select" placeholder="select type" asp-items="@(new SelectList(ViewBag.customer,"Id","Value"))" onchange="return clientchange1()">
                        <option value="">--Select--</option>
                    </select>
                </div>
                <div style="display:none">
                    <input type="text" id="ic_to" value="@ViewBag.ic_to" />
                    <input type="text" id="ic_toemail" value="@ViewBag.ic_toemail" />
                    <input type="text" id="ic_email" value="@ViewBag.ic_email" />
                </div>
                <div class="col-lg-1 col-md-1 ">
                    <label for="name" class="form-label float-lg-end">@Localizer["Year"]:</label>
                </div>
                <div class="col-md-2 justify-content-lg-end justify-content-md-end justify-content-center mt-lg-0 mt-md-0 mt-3">
                    <select id="yearDropdown" class="form-select" asp-items="@(new SelectList(ViewBag.year,"Id","Value"))" onchange="return clientchange1()">
                        <option value="">--Select Year--</option>
                        <!-- You can dynamically add more options here if needed -->
                    </select>
                </div>
                <div id="claimnodiv" style="display:none;">
                    <div class="col-lg-1 col-md-1">
                        <label for="name" class="form-label float-lg-end">@Localizer["Claim No"]:</label>
                    </div>
                    <div class="col-md-2 justify-content-lg-end justify-content-md-end justify-content-center mt-lg-0 mt-md-0 mt-3">
                        <select id="claimdropdown" class="form-select" asp-items="@(new SelectList(ViewBag.claimno,"Id","Value"))" onchange="return claimdropdown()">
                            <option value="">--Select Claim No--</option>
                            <!-- You can dynamically add more options here if needed -->
                        </select>
                    </div>
                </div>



                <div class="col-lg-1 col-md-1 " style="padding-left:10%">
                    <button class="btn btn-md text-light bg-primary mt-3 mt-lg-0 mt-md-0 ml-2" onclick="return filter()"
                            type="button" title="Filter">
                        <i class="fa-solid fa-filter"></i>
                    </button>
                </div>

            </div>
            <div class="row align-items-center">
                <ul class="nav nav-tabs" id="tabMenu" role="tablist">
                    <li class="nav-item" style="display:none">
                        <button class="nav-link" id="client-tab" data-bs-toggle="tab" data-bs-target="#client" type="button" role="tab" aria-controls="client" onclick="return clienttab()">
                            Client
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" id="enquiry-tab" data-bs-toggle="tab" data-bs-target="#enquiry" type="button" role="tab" aria-controls="enquiry" onclick="return enquirytab()">
                            Enquiry
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" id="claim-tab" data-bs-toggle="tab" data-bs-target="#claim" type="button" role="tab" aria-controls="claim" onclick="return claimtab()">
                            Claim
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" id="enquiry-atttab" data-bs-toggle="tab" data-bs-target="#enquiryatt" type="button" role="tab" aria-controls="enquiryatt" onclick="return enquiryatttab()">
                            Enquiry Attachment
                        </button>
                    </li>

                    <li class="nav-item">
                        <button class="nav-link" id="claim-atttab" data-bs-toggle="tab" data-bs-target="#claimatt" type="button" role="tab" aria-controls="claimatt" onclick="return claimatttab()">
                            Claim Attachment
                        </button>
                    </li>
                    @*     <li class="nav-item">
                    <button class="nav-link" id="general-tab" data-bs-toggle="tab" data-bs-target="#general" type="button" role="tab" aria-controls="general" onclick="return generaltab()">
                    General
                    </button>
                    </li> *@
                </ul>
            </div>
        </div>

        <div id="attachGrid">

            <div class="table-responsive">
                <table class="table table-bordered" id="dataTable3" width="100%" cellspacing="0">
                    <thead style="display:none" id="datatable3head">
                        <tr>
                            <th style="width:0%">Sr.No</th>
                            <th style="display:none">Id</th>
                            <th style="width: 4%">Attachment</th>
                            <td style="width: 6%">Download</td>
                        </tr>
                    </thead>
                    <tbody id="attachTableBody">
                    </tbody>
                </table>

            </div>

        </div>



        <div id="detailsGrid" style="display:none">
            <h5 style="display:none">Details for Year: <span id="selectedYear">2025</span></h5>
            <div class="table-responsive">
                <table class="table table-bordered" id="dataTable2" width="100%" cellspacing="0">
                    <thead>
                        <tr>
                            <th style="width:6%">Sr.No</th>
                            <th style="display:none">Id</th>
                            <th style="width:12%">From</th>
                            <th style="width:12%">To</th>
                            <th style="width:10%">Subject</th>
                            <th style="width:12%">Date</th>
                            <th style="width:4%">Attachment</th>
                            <td style="display:none" width="6%">View</td>
                        </tr>
                    </thead>
                    <tbody id="detailsTableBody">
                    </tbody>
                </table>

                <table class="table table-bordered" id="dataTable4" width="100%" cellspacing="0" style="display:none;">
                    <thead>
                        <tr>
                            <th style="width:6%">Sr.No</th>
                            <th style="width:6%">Claim No</th>
                            <th style="display:none">Id</th>
                            <th style="width:12%">From</th>
                            <th style="width:12%">To</th>
                            <th style="width:10%">Subject</th>
                            <th style="width:12%">Date</th>
                            <th style="width:4%">Attachment</th>
                            <td style="display:none" width="6%">View</td>
                        </tr>
                    </thead>
                    <tbody id="detailsTableBody1">
                    </tbody>
                </table>

                <div class="row mt-3">
                    <div class="col-lg-5 col-md-5 col-12 ">
                        <div class="row ">
                            <div class="col-lg-3 col-md-3 col-12 d-flex justify-content-lg-start justify-content-md-start justify-content-center ">
                                <h6 class="mt-2"> @Localizer["Show"]</h6>&nbsp;&nbsp;
                                <select name="table_id_length" id="table_length_select2" aria-controls="table_id" class="form-select w-auto">
                                    <option value="10">10</option>
                                    <option value="25">25</option>
                                    <option value="50">50</option>
                                    <option value="100">100</option>
                                </select>
                                &nbsp;&nbsp;
                                <h6 class="mt-2"> @Localizer["entries"]</h6>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-2"></div>
                    <div class="col-lg-5 col-md-5 col-12 mt-lg-0 mt-md-0 mt-3">
                        <nav aria-label="Page navigation example">
                            <div id="table_id_length2">

                                <div id="dataTable2-custom-pagination" class=" d-flex text-center text-lg-end justify-content-end  text-end float-end">
                                    <ul class="pagination justify-content-lg-end justify-content-md-end justify-content-center">


                                        <li class="page-item disabled">
                                            <button class="page-link" href="#" aria-label="Previous" data-page="0"> <span>&laquo;</span></button>
                                        </li>
                                        <li class="page-item active"><button class="page-link" href="#" data-page="1">1</button></li>

                                        <li class="page-item "><button class="page-link" href="#" data-page="2" aria-label="Next">  <span>&raquo;</span></button></li>

                                    </ul>
                                </div>
                            </div>
                        </nav>
                    </div>
                </div>
            </div>

        </div>


        @* Start Filter Model*@
        <div class="modal fade" id="addfilter" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
             style="display:none">
            <div class="modal-dialog modal-md" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title text-dark fw-bold" style="font-size: larger;" id="exampleModalLabel">Filter</h5>
                        <button type="button"
                                class="btn-close bg-danger modal-close"
                                data-bs-dismiss="modal"
                                aria-label="Close"></button>
                    </div>
                    <div class="modal-body text-dark" style=" background-color: #f8f9fa;padding: 15px;border-radius: 8px;">
                        @*    <div class="flex-container"> *@
                        @*  <div class="box" style="background-color: #ffffff;border: 1px solid #ddd;box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);"> *@
                        <div class="row">
                            <div class="col-xs-6 col-sm-6 col-md-12 ">
                                <div class="form-group form-group-sm">

                                    <label class="control-label fw-bold" style="font-size: larger;" for="from">From</label>
                                    <span style="padding-left:40px"><input type="text" class="form-control" id="i_from" style="font-size:medium" /></span>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-6 col-sm-6 col-md-12 ">
                                <div class="form-group form-group-sm">
                                    <label class="control-label fw-bold" style="font-size: larger;" for="to">To</label>
                                    <span style="padding-left:59px"><input type="text" class="form-control" id="i_to" value="" style="font-size:medium" /></span>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-6 col-sm-6 col-md-12 ">
                                <div class="form-group form-group-sm">
                                    <label class="control-label fw-bold" style="font-size: larger;" for="subject">Subject</label>
                                    <span style="padding-left:23px"><input type="text" class="form-control" id="i_subject" value="" style="font-size:medium" /></span>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-6 col-sm-6 col-md-12 ">
                                <div class="form-group form-group-sm">
                                    <label class="control-label fw-bold" style="font-size: larger;" for="hasthewords">Has the words</label>
                                    <span style="padding-left:23px"><input type="text" class="form-control" id="i_hasthewords" value="" style="font-size:medium" /></span>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-6 col-sm-6 col-md-12 ">
                                <div class="form-group form-group-sm">
                                    <label class="control-label fw-bold" style="font-size: larger;" for="year">Year</label>
                                    <span style="padding-left:23px">
                                        <select id="yearDropdown1" class="form-select" asp-items="@(new SelectList(ViewBag.year,"Id","Value"))">
                                            <option value="">--Select Year--</option>
                                        </select>
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-6 col-sm-6 col-md-12 ">
                                <div class="form-group form-group-sm">
                                    <label class="control-label fw-bold" style="font-size: larger;" for="subject">Search</label>
                                    <select class="form-select" id="i_tab">
                                        @*<option value="client">Client</option> *@
                                        <option value="enquiry">Enquiry</option>
                                        <option value="claim">Claim</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        @*</div>*@
                    </div>
                    <div class="modal-footer">
                        <button title="Save" type="submit" id="btnsubmit" value="Create" class="btn btn-primary" onclick="submitfilter()">@Localizer["Submit"]</button>
                        <button type="button" title="Close" class="btn btn-danger" data-dismiss="modal" onclick="CancelData()">@Localizer["Cancel"]</button>
                    </div>
                </div>
            </div>
        </div>

        @* End filter model *@


        @* Start view model *@
        <div class="modal fade" id="addSubscription" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
            <div class="modal-dialog modal-xl" role="document">
                <div class="modal-content" style="width:106%">
                    <div class="modal-header">
                        <h5 class="modal-title text-dark fw-bold" style="font-size: larger;" id="exampleModalLabel">Email</h5>
                        <button type="button"
                                class="btn-close bg-danger modal-close"
                                data-bs-dismiss="modal"
                                aria-label="Close"></button>
                    </div>
                    <div class="modal-body text-dark" style=" background-color: #f8f9fa;padding: 15px;border-radius: 8px;">
                        <div class="flex-container">
                            <div style="background-color: #4a4747;border: 1px solid #ddd;box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);margin-bottom: 15px;padding: 15px;width: 11%;max-width: 800px;">
                                <div class="arrow-container" id="arrow-container">
                                    @*   <div class="arrow-item" id="date1" ></div>
                                    <div style="padding:12px"></div>
                                    <div class="arrow-item" id="date2" ></div>
                                    <div style="padding:12px"></div>
                                    <div class="arrow-item" id="date3" ></div> *@
                                </div>
                            </div>
                            <div class="box" style="background-color: #ffffff;border: 1px solid #ddd;box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);width:800px">
                                <div class="form-group">
                                    <h3>
                                        <label class="control-label fw-bold" style="font-size: larger;" for="subject">Subject :</label>
                                        <span style="padding-left:23px"><label id="ic_subjectlabel" value="" style="font-size:larger"></label></span>
                                    </h3>
                                </div>

                                <div class="form-group">
                                    <label class="control-label" style="font-weight:500;" for="from">From :</label>
                                    <span style="padding-left:5px"><label id="ic_fromlabel" value="" style="font-size:medium;font-weight:500"></label></span>

                                    <label class="" style="font-weight:500;padding-left: 10%;" for="to">To :</label>
                                    <span style="padding-left:5px"><label id="ic_tolabel" value="" style="font-size:medium;font-weight:500"></label></span>

                                    <div style="width: 100%; height: 1px; background-color: black; margin-top: 5px;"></div>

                                </div>



                                <div class="form-group">
                                    @*  <label class="control-label fw-bold" for="message" style="display: inline-block; vertical-align: top; margin-right: 10px;font-size: larger;">Message:</label> *@
                                    @*  <textarea rows="20" cols="85" readonly id="ic_bodylabel" style="font-size:medium;border:none"></textarea> *@
                                    <div id="ic_bodyhtml" style="font-size:medium;border:none"></div>
                                </div>
                                <div id="attachments-container">
                                    <div class="attachments" id="attachdiv">
                                        <button id="viewattachments" style="display: inline-block;">
                                            <div style="padding: 8px;" id="filename"></div>
                                        </button>
                                        <button style="display: inline-block;height: 42px;width: 40px;">
                                            <div style="text-align: center; display: inline-block; " id="filebuttons2"></div>
                                        </button>
                                    </div>
                                </div>

                                @*   <div class="attachments">
                                <div id="viewattachments">

                                <div style="padding: 8px;" id="filename"></div>
                                <div style="text-align: center;" id="filebuttons2"></div>
                                </div>
                                </div>
                                *@




                                @*  <div class="attachments">
                                <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                                <thead>
                                <tr>
                                <th colspan="3" style="text-align: left; padding: 10px; font-size: larger; font-weight: bold; border: 1px solid #ddd;">
                                Attachments:
                                </th>
                                </tr>
                                </thead>
                                <tbody id="viewattachments">
                                <tr style=" border: 1px solid #ddd;">
                                <td style="padding: 8px;" id="filename"></td>
                                <td style="text-align: center;" id="filebuttons1">

                                </td>
                                <td style="text-align: center;" id="filebuttons2">

                                </td>
                                </tr>

                                <tr style=" border: 1px solid #ddd;">
                                <td style="padding: 8px;">file1.png</td>
                                <td style="text-align: center;">
                                <a href="~/images/sample data/sampleimage.png" title="View Image">
                                <i class="fas fa-eye" style="font-size: 16px; color: blue;"></i>
                                </a>
                                </td>
                                <td style="text-align: center;">
                                <a href="~/images/sample data/sampleimage.png" download="sampleimage.png" title="Download Image">
                                <i class="fas fa-download" style="font-size: 16px; color: green;"></i>
                                </a>
                                </td>
                                </tr>
                                </tbody>
                                </table>


                                </div>
                                </div> *@
                                @*          <div class="box" style="background-color: #ffffff;border: 1px solid #ddd;box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);height:50%">
                                <div class="conversation">
                                <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                                <thead>
                                <tr>
                                <th colspan="3" style="text-align: left; padding: 10px; font-size: larger; font-weight: bold; border: 1px solid #ddd;">
                                Conversation:
                                </th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr style=" border: 1px solid #ddd;">
                                <td class="conversation-item" style="padding: 8px;">  <i class="fas fa-paper-plane" style="color: blue; font-size: 16px;" title="Sent"></i></td>
                                <td style="text-align:left;">
                                29/09/2024
                                </td>
                                </tr>
                                <tr style=" border: 1px solid #ddd;">
                                <td class="conversation-item" style="padding: 8px;">  <i class="fas fa-envelope" style="color: green; font-size: 16px;" title="Received"></i></td>
                                <td style="text-align: left;">
                                30/09/2024
                                </td>
                                </tr>
                                </tbody>
                                </table>
                                </div>
                                </div> *@



                            </div>


                        </div>

                        @*  <div class="buttons">
                        <button class="btn btn-danger" onclick="CancelData()" type="button" data-dismiss="modal">Close</button>
                        </div> *@
                    </div>
                </div>
            </div>
        </div>


        @* End view model *@

        <!-- End Griddata-->
        <!-- start Pagination-->
        <!-- end Pagination-->
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>

    // initializeDataTable('#dataTable2', 'dataTable2-custom-pagination');
    //                                  $('#table_length_select2').change();

    $(document).ready(function () {

        $("#custom-search").on("keyup", function () {
            var value = $(this).val().toLowerCase();

            $("#detailsTableBody tr, #detailsTableBody1 tr, #attachTableBody tr").filter(function () {
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
            });
        });



        // Extract URL parameters
        var urlParams = new URLSearchParams(window.location.search);
        var client = urlParams.get('client');


        // Match the text in the dropdown options and set the value
        if (client) {
            $('#clientDropdown option').each(function () {
                if ($(this).text() == client) {
                    $('#clientDropdown').val($(this).val());
                    $('#clientDropdown1').val($(this).val());
                }
            });
        }
        var tab = urlParams.get('tab');
        var email = urlParams.get('email');

        if (tab == "Insurance") {
            tab = "client";
        }
        // $('#' + tab + '-tab').attr('class', 'nav-link active');

        $('#enquiry-tab').attr('class', 'nav-link active');

        $('#detailsgridname').css('display', 'block');
        var tab = "enquiry";

        show(2025, client, email, tab);
    });
    function downloadFile(filePath) {
        console.log("Original File Path:", filePath); // Log the input

        try {
            // Trim and encode the file path
            const trimmedPath = filePath.trim();
            const encodedPath = encodeURIComponent(trimmedPath);
            console.log("Encoded File Path:", encodedPath); // Log the encoded path

            // Construct the URL
            const url = `/InboxClient/DownloadFile?filePath=${encodedPath}`;
            console.log("Download URL:", url); // Log the final URL

            // Open the file in a new tab
            window.open(url, "_blank");
        } catch (error) {
            console.error("Error during file download:", error); // Log any errors
        }
    }

    function show(ic_year, ic_fromname, ic_from, tab) {

        $('#enquiry-tab').attr('class', 'nav-link active');

        // var urlParams = new URLSearchParams(window.location.search);

        // var tab = urlParams.get('tab');
        // var tab = "enquiry";

        $('#detailsgridname').css('display', 'block');
        $('#yearDropdown').val(ic_year);
        $('#yearDropdown option').each(function () {
            return $(this).text() === ic_year; // Match the text
        }).prop('selected', true);

        ic_year = $('#yearDropdown option:selected').text();
        var data = {
            ic_year: ic_year, // Use the provided `sc_year` parameter
            ic_fromname: ic_fromname,
            ic_from: ic_from,
            tab: tab,

        };
        $.ajax({
            url: '/InboxClient/fetchdetails', // Controller action URL
            type: 'POST',             // HTTP method
            data: data,
            // Data to send (query parameter)
            success: function (response) {
                // Handle success - update the page dynamically
                console.log('Response:', response);

                $('#detailsTableBody').html('');
                var htmltab = '';

                for (var i = 0; i < response.sentclientList.length; i++) {
                    htmltab += '<tr>';
                    htmltab += '<td onclick="inboxmsg(' + response.sentclientList[i].ic_id + ')">' + (i + 1) + '</td>';
                    htmltab += '<td style="display:none">' + response.sentclientList[i].ic_id + '</td>';
                    htmltab += '<td onclick="inboxmsg(' + response.sentclientList[i].ic_id + ')">' + response.sentclientList[i].ic_from + '</td>';
                    htmltab += '<td onclick="inboxmsg(' + response.sentclientList[i].ic_id + ')">' + response.sentclientList[i].ic_to + '</td>';
                    htmltab += '<td onclick="inboxmsg(' + response.sentclientList[i].ic_id + ')">' + response.sentclientList[i].ic_subject + '</td>';
                    htmltab += '<td onclick="inboxmsg(' + response.sentclientList[i].ic_id + ')">' + response.sentclientList[i].ic_receiveddate + '</td>';
                    // htmltab += '<td >' + response[i].ic_attachment + '</td>';


                    if (response.sentclientList[i].ic_attachment != "No attachments available.") {
                        htmltab += '<td style="width:4%" ><i class="fa fa-paperclip" aria-hidden="true"></i></td>';
                    }
                    else {
                        htmltab += '<td style="width:4%"></td>';
                    }

                    //htmltab += '<td><i class="fas fa-eye text-primary" onclick="inboxmsg('+response[i].sc_toemail+')"></i></td>';
                    htmltab += '<td style="display:none"><i class="fas fa-eye text-primary" onclick="inboxmsg(' + response.sentclientList[i].ic_id + ')"></i></td>';

                    htmltab += '</tr>';


                }




                $('#detailsTableBody').html(htmltab);

                // Example: Update a specific section with the response data
                $('#content-area').html(response);
            },
            error: function (xhr, status, error) {
                // Handle errors
                console.error('Error:', error);
            }
        });


        $('#detailsGrid').css('display', 'block');
        $('#detailsTableBody').css('display', 'contents');
    }

    function inboxmsg(id) {

        // Show the modal
        $("#addSubscription").modal("show");

        // Data payload for the request
        var data = { id: id };

        // Perform AJAX POST request
        $.ajax({
            url: '/InboxClient/showdetails', // Controller action URL
            type: 'POST',                   // HTTP method
            data: data,                     // Data to send
            success: function (response) {
                console.log(response);

                if (response) {
                    const attachmentsContainer = document.getElementById("attachments-container");

                    // Clear previous content before updating
                    attachmentsContainer.innerHTML = '';

                    //if (response.ic_attachment != "" ) {
                    if (response.ic_attachment != "No attachments available.") {


                        const attachments = response.ic_attachment;


                        // Split attachments using a comma
                        const attachmentArray = attachments.trim().split(',').map(a => a.trim()); // Trim extra spaces

                        console.log("Raw Attachments:", attachments);
                        console.log("Split Attachments Array:", attachmentArray); // Debugging

                        // Generate the HTML
                        let attachmentHTML = '';

                        attachmentArray.forEach((attachmentPath) => {
                            if (!attachmentPath) return; // Ignore empty values

                            const fileName = attachmentPath.split(/[/\\]/).pop(); // Extract filename
                            const safeAttachmentPath = encodeURIComponent(attachmentPath); // Encode for safety

                            attachmentHTML += `
                                    <div class="attachments" style="margin: 8px 0;">
                                        <!-- Button for filename -->
                                        <button style="display: inline-block; padding: 8px; margin-right: 8px;" title="${fileName}">
                                            ${fileName}
                                        </button>
                                        <!-- Button for download -->
                                        <button style="display: inline-block; height: 42px; width: auto;"
                                                onclick="downloadFile('${safeAttachmentPath}')">
                                            <i class="fa-solid fa-chevron-down" style="font-size: 16px; color: black;"></i>
                                        </button>
                                    </div>`;
                        });

                        // Inject into the DOM

                        document.getElementById("attachments-container").innerHTML = attachmentHTML;

                        $('#attachdiv').show();
                    }

                    else {
                        $('#attachdiv').hide();

                    }
                    $('#ic_tolabel').text(response.ic_to || 'N/A');
                    $('#ic_fromlabel').text(response.ic_from || 'N/A');
                    $('#ic_subjectlabel').text(response.ic_subject || 'N/A');


                    // const formattedBody = (response.ic_body || '').replace(/<br\s*\/?>/gi, "\n").replace(/<\/?[^>]+(>|$)/g, "");


                    //$('#ic_bodylabel').val(formattedBody);

                    // var parsedHTML = $.parseHTML(response.ic_body);
                    // var bodyContent = $(parsedHTML).find('body').html();  // Get the body content

                    // Display the body content inside the #ic_bodylabel
                    // $('#ic_bodylabel').html(response.ic_body || '');

                    var bodyh = '' + response.ic_body + '';



                    $('#ic_bodyhtml').html(bodyh || '');



                    // Optional: Update a specific content area with additional information
                    $('#content-area').html(response.content || 'No content available.');


                    $.ajax({
                        url: '/InboxEmail/inboxdates', // Controller action URL
                        type: 'POST',                   // HTTP method
                        data: data,                     // Data to send
                        success: function (response) {
                            console.log(response);
                            // $('#date1').show();
                            // $('#date2').show();
                            // $('#date3').show();

                            // for (var i = 0; i < response.length; i++) {
                            //     if (response.length == "1") {
                            //         const date1 = response[0].i_receiveddate;
                            //         $('#date1').val(response[0].i_id);
                            //         $('#date1').attr('onclick', `inboxmsg('${response[0].i_id}')`);
                            //         $('#date1').text(date1);
                            //         $('#date2').hide();
                            //         $('#date3').hide();
                            //     }
                            //     else {
                            //         const date1 = response[0].i_receiveddate;
                            //         const date2 = response[1].i_receiveddate;
                            //         const date3 = response[2].i_receiveddate;

                            //         $('#date1').val(response[0].i_id);
                            //         $('#date2').val(response[1].i_id);
                            //         $('#date3').val(response[2].i_id);


                            //         $('#date1').attr('onclick', `inboxmsg('${response[0].i_id}')`);
                            //         $('#date2').attr('onclick', `inboxmsg('${response[1].i_id}')`);
                            //         $('#date3').attr('onclick', `inboxmsg('${response[2].i_id}')`);



                            //         $('#date1').text(date1);
                            //         $('#date2').text(date2);
                            //         $('#date3').text(date3);
                            //         break;
                            //     }
                            // }
                            //                              const arrowcontainer = document.getElementById("arrow-container");

                            // // Clear previous content before updating
                            //                       arrowcontainer.innerHTML = '';

                            $('#arrow-container').empty();

                            // Iterate through the response and dynamically create elements
                            response.forEach((item, index) => {
                                const date = item.i_receiveddate; // Get the date
                                const id = item.i_id; // Get the ID

                                // Create a new arrow div
                                const arrowDiv = $(`<div class="arrow-item" id="date${index + 1}" onclick="inboxmsg('${id}')">${date}</div>`);

                                // Append the arrow div to the container
                                $('#arrow-container').append(arrowDiv);

                                // Add spacing if needed
                                $('#arrow-container').append('<div style="padding:12px"></div>');
                            });






                            // Optional: Update a specific content area with additional information
                            $('#content-area').html(response.content || 'No content available.');







                        },
                        error: function (xhr, status, error) {
                            // Display error notification
                            console.error('Error:', error);
                            alert('An error occurred while fetching the message details. Please try again later.');
                        }
                    });




                } else {
                    console.error('Empty response received');
                    // alert('No data available.');
                }
            },
            error: function (xhr, status, error) {
                // Display error notification
                console.error('Error:', error);
                alert('An error occurred while fetching the message details. Please try again later.');
            }
        });
    }

    // function downloadfile() {
    //     const filePath = $('#filebuttons2').val();

    //     // Encode the file path to make it safe for URLs
    //     const encodedPath = encodeURIComponent(filePath);

    //     // Construct the URL to call the controller
    //     const url = `/InboxClient/DownloadFile?filePath=${encodedPath}`;

    //     // Open the file in a new tab or start downloading
    //     window.open(url, "_blank");
    // }

    //     function downloadFile(encodedPath) {
    //     const url = `/InboxClient/DownloadFile?filePath=${encodedPath}`;
    //     window.open(url, "_blank");
    // }



    function viewfile() {
        const filePath = $('#filebuttons1').val();

        // Encode the file path to make it safe for URLs
        const encodedPath = encodeURIComponent(filePath);

        // Construct the URL to call the controller
        const url = `/InboxClient/ViewFile?filePath=${encodedPath}`;

        // Open the file in a new tab or start downloading
        window.open(url, "_blank");
    }

    function CancelData() {
        $("#addSubscription").modal("hide");
    }


    function clientchange() {
        $('#detailsgridname').css('display', 'none');
        $('#detailsGrid').css('display', 'none');

        var urlParams = new URLSearchParams(window.location.search);
        var tab = urlParams.get('tab');

        var clientid = $('#clientDropdown').val();
        var data = {
            clientid: clientid,
            tab: tab,
        };

        $.ajax({
            url: '/InboxClient/Clientchange', // Controller action URL
            type: 'POST',             // HTTP method
            data: data,
            success: function (response) {
                console.log(response);
                // Handle success - update the page dynamically

                $('#tbodyid').html('');
                var htmltab = '';

                for (var i = 0; i < response.length; i++) {
                    htmltab += '<tr>';
                    htmltab += '<td>' + (i + 1) + '</td>';
                    htmltab += '<td style=display:none>' + response[i].ic_from + '</td>';
                    htmltab += '<td style=display:none>' + response[i].ic_fromname + '</td>';
                    htmltab += '<td onclick="show(\'' + response[i].ic_year + '\', \'' + response[i].ic_fromname + '\', \'' + response[i].ic_from + '\')">' + response[i].ic_year + '</td>';
                    htmltab += '<td>' + response[i].ic_count + '</td>';
                    htmltab += '</tr>';

                    // Prepare the URL parameters
                    var ic_from = response[i].ic_from;
                    var ic_fromname = response[i].ic_fromname;
                    if (response[i].ic_from == '') {
                        var ic_from = "";
                        var ic_fromname = "";
                    }
                }

                // Update the URL without reloading the page
                history.pushState(null, '', '?email=' + ic_from + '&client=' + ic_fromname + '&tab=' + tab);

                $('#tbodyid').html(htmltab);

                // Example: Update a specific section with the response data
                $('#content-area').html(response);
            },
            error: function (xhr, status, error) {
                // Handle errors
                console.error('Error:', error);
            }
        });

        var client = $('#clientDropdown').val();

        // Match the text in the dropdown options and set the value
        if (client) {
            $('#clientDropdown option').each(function () {
                if ($(this).val() == client) {
                    $('#clientDropdown').val($(this).val());
                    $('#clientDropdown1').val($(this).val());
                }
            });
        }
    }


    function clientchange1() {

        $('#detailsgridname').css('display', 'none');
        $('#detailsGrid').css('display', 'none');

        // var urlParams = new URLSearchParams(window.location.search);
        // var tab = urlParams.get('tab');
        var year = $('#yearDropdown option:selected').text();

        $('#detailsgridname').css('display', 'block');
        $('#detailsGrid').css('display', 'block');


        if ($('#enquiry-tab').hasClass('active')) {
            tab = "Enquiry";
        }
        else {
            tab = "Claim";
        }

        var clientid = $('#clientDropdown1').val();
        var data = {
            clientid: clientid,
            tab: tab,
            year: year,
        };


        if ($('#enquiry-tab').hasClass('active')) {
            tab = "Enquiry";

            $('#dataTable4').hide();

            $('#claimnodiv').css('display', 'none');
            $.ajax({
                url: '/InboxClient/Clientchange1', // Controller action URL
                type: 'POST',             // HTTP method
                data: data,
                success: function (response) {
                    console.log(response);

                    // If the response length is 0, do not update the table or URL
                    if (response.length === 0) {
                        // alert("no data");
                        $('#detailsTableBody').html('');
                        return; // Exit the function early
                    }

                    // Make details grid visible when there is data

                    $('#detailsTableBody').html('');  // Clear previous table content

                    var htmltab = '';
                    for (var i = 0; i < response.length; i++) {
                        htmltab += '<tr>';
                        htmltab += '<td onclick="inboxmsg(' + response[i].ic_id + ')">' + (i + 1) + '</td>';
                        htmltab += '<td style="display:none">' + response[i].ic_id + '</td>';
                        htmltab += '<td onclick="inboxmsg(' + response[i].ic_id + ')">' + response[i].ic_from + '</td>';
                        htmltab += '<td onclick="inboxmsg(' + response[i].ic_id + ')">' + response[i].ic_to + '</td>';
                        htmltab += '<td onclick="inboxmsg(' + response[i].ic_id + ')">' + response[i].ic_subject + '</td>';
                        htmltab += '<td onclick="inboxmsg(' + response[i].ic_id + ')">' + response[i].ic_receiveddate + '</td>';
                        // htmltab += '<td >' + response[i].ic_attachment + '</td>';

                        if (response[i].ic_attachment != "No attachments available.") {
                            htmltab += '<td style="width:4%" ><i class="fa fa-paperclip" aria-hidden="true"></i></td>';
                        }
                        else {
                            htmltab += '<td style="width:4%"></td>';
                        }

                        htmltab += '<td style="display:none"><i class="fas fa-eye text-primary" onclick="inboxmsg(' + response[i].ic_id + ')"></i></td>';
                        htmltab += '</tr>';
                    }

                    // Update the table body with new data
                    $('#detailsTableBody').html(htmltab);

                    // Example: Update a specific section with the response data (if any)
                    $('#content-area').html(response);
                },
                error: function (xhr, status, error) {
                    // Handle errors
                    console.error('Error:', error);
                }
            });
        }

        else {
            tab = "Claim";
            $('#dataTable4').show();
            $('#claimnodiv').css('display', 'contents');

            $.ajax({
                url: '/InboxClient/Clientchange1', // Controller action URL
                type: 'POST',             // HTTP method
                data: data,
                success: function (response) {
                    console.log(response);

                    // If the response length is 0, do not update the table or URL
                    if (response.length === 0) {
                        // alert("no data");
                        $('#detailsTableBody1').html('');
                        return; // Exit the function early
                    }

                    // Make details grid visible when there is data

                    $('#detailsTableBody1').html('');  // Clear previous table content

                    var htmltab = '';
                    for (var i = 0; i < response.length; i++) {
                        htmltab += '<tr>';
                        htmltab += '<td onclick="inboxmsg(' + response[i].ic_id + ')">' + (i + 1) + '</td>';
                        htmltab += '<td onclick="inboxmsg(' + response[i].ic_id + ')">' + response[i].ic_claimno + '</td>';
                        htmltab += '<td style="display:none">' + response[i].ic_id + '</td>';
                        htmltab += '<td onclick="inboxmsg(' + response[i].ic_id + ')">' + response[i].ic_from + '</td>';
                        htmltab += '<td onclick="inboxmsg(' + response[i].ic_id + ')">' + response[i].ic_to + '</td>';
                        htmltab += '<td onclick="inboxmsg(' + response[i].ic_id + ')">' + response[i].ic_subject + '</td>';
                        htmltab += '<td onclick="inboxmsg(' + response[i].ic_id + ')">' + response[i].ic_receiveddate + '</td>';
                        // htmltab += '<td >' + response[i].ic_attachment + '</td>';

                        if (response[i].ic_attachment != "No attachments available.") {
                            htmltab += '<td style="width:4%" ><i class="fa fa-paperclip" aria-hidden="true"></i></td>';
                        }
                        else {
                            htmltab += '<td style="width:4%"></td>';
                        }

                        htmltab += '<td style="display:none"><i class="fas fa-eye text-primary" onclick="inboxmsg(' + response[i].ic_id + ')"></i></td>';
                        htmltab += '</tr>';
                    }

                    // Update the table body with new data
                    $('#detailsTableBody1').html(htmltab);

                    // Example: Update a specific section with the response data (if any)
                    $('#content-area').html(response);
                },
                error: function (xhr, status, error) {
                    // Handle errors
                    console.error('Error:', error);
                }
            });
        }

        var client = $('#clientDropdown1').val();

        // Match the text in the dropdown options and set the value
        if (client) {
            $('#clientDropdown1 option').each(function () {
                if ($(this).val() == client) {
                    $('#clientDropdown1').val($(this).val());
                }
            });
        }
    }



    function clienttab() {
        $('#dataTable3').show();
        $('#dataTable2').hide();
        $('#dataTable4').hide();
        $('#datatable3head').show();

        $('#detailsGrid').css('display', 'block');

        $('#attachGrid').css('display', 'none');
        var tab = "Insurance";

        $('#client-tab').attr('aria-selected', 'true');
        $('#enquiry-tab').attr('aria-selected', 'false');
        $('#claim-tab').attr('aria-selected', 'false');
        $('#general-tab').attr('aria-selected', 'false');

        $('#client-tab').attr('class', 'nav-link active');
        $('#enquiry-tab').attr('class', 'nav-link');
        $('#claim-tab').attr('class', 'nav-link');
        $('#general-tab').attr('class', 'nav-link');


        var urlParams = new URLSearchParams(window.location.search);
        var email = urlParams.get('email');

        var data = {
            email: email,
            tab: tab,
        };

        $.ajax({
            url: '/InboxClient/Tab?email=' + email + '&tab=' + tab,
            type: 'POST',
            data: data,
            success: function (response) {
                console.log('Response:', response);
                $('#tbodyid').html('');
                var htmltab = '';
                for (var i = 0; i < response.length; i++) {
                    htmltab += '<tr>';
                    htmltab += '<td>' + (i + 1) + '</td>';
                    htmltab += '<td style=display:none>' + response[i].ic_from + '</td>';
                    htmltab += '<td style=display:none>' + response[i].ic_fromname + '</td>';
                    htmltab += '<td onclick="show(\'' + response[i].ic_year + '\', \'' + response[i].ic_fromname + '\', \'' + response[i].ic_from + '\')">' + response[i].ic_year + '</td>';
                    htmltab += '<td>' + response[i].ic_count + '</td>';
                    htmltab += '</tr>';

                    //window.location.search = '?email=' + response[i].sc_to + '&client=' + response[i].sc_toname + '&tab=' + tab;
                    history.pushState(null, '', '?email=' + ic_from + '&client=' + ic_fromname + '&tab=' + tab);
                }
                $('#tbodyid').html(htmltab);
                $('#content-area').html(response);
            },
            error: function (xhr, status, error) {
                console.error('Error:', error);
            }
        });
    }

    function enquirytab() {
        $('#custom-search').val('');

        $('#detailsGrid').css('display', 'block');
        $('#attachGrid').css('display', 'none');
        $('#dataTable2').show();
        $('#dataTable3').hide();
        $('#dataTable4').hide();
        $('#detailsTableBody').css('display', 'contents');
        $('#detailsTableBody1').css('display', 'none');

        $('#claimnodiv').css('display', 'none');

        var tab = "enquiry";

        $('#enquiry-tab').attr('aria-selected', 'true');
        $('#client-tab').attr('aria-selected', 'false');
        $('#claim-tab').attr('aria-selected', 'false');
        $('#general-tab').attr('aria-selected', 'false');
        $('#enquiry-atttab').attr('aria-selected', 'false');
        $('#claim-atttab').attr('aria-selected', 'false');

        $('#enquiry-tab').attr('class', 'nav-link active');
        $('#client-tab').attr('class', 'nav-link');
        $('#claim-tab').attr('class', 'nav-link');
        $('#general-tab').attr('class', 'nav-link');
        $('#enquiry-atttab').attr('class', 'nav-link ');
        $('#claim-atttab').attr('class', 'nav-link ');

        //var email = $('#clientDropdown1').val();
        //  var year = $('#yearDropdown').val();
        var year = $('#yearDropdown option:selected').text();
        var urlParams = new URLSearchParams(window.location.search);
        //var email = $('#clientDropdown1 option:selected').text();
        var email = urlParams.get('email');
        var data = {
            ic_from: email,
            tab: tab,
            ic_year: year,
        };

        // $.ajax({
        //     url: '/InboxClient/Tab?email=' + email + '&tab=' + tab, // Controller action URL
        //     type: 'POST',             // HTTP method
        //     data: data,      // Data to send (query parameter)
        //     success: function (response) {
        //         // Handle success - update the page dynamically
        //         console.log('Response:', response);
        //         $('#tbodyid').html('');
        //         var htmltab = '';
        //         for (var i = 0; i < response.length; i++) {
        //             htmltab += '<tr>';
        //             htmltab += '<td>' + (i + 1) + '</td>';
        //             htmltab += '<td style=display:none>' + response[i].ic_from + '</td>';
        //             htmltab += '<td style=display:none>' + response[i].ic_fromname + '</td>';
        //             htmltab += '<td onclick="show(\'' + response[i].ic_year + '\', \'' + response[i].ic_fromname + '\', \'' + response[i].ic_from + '\')">' + response[i].ic_year + '</td>';
        //             htmltab += '<td>' + response[i].ic_count + '</td>';
        //             htmltab += '</tr>';

        //             // window.location.search = '?email=' + response[i].sc_to + '&client=' + response[i].sc_toname + '&tab=' + tab;
        //             history.pushState(null, '', '?email=' + response[i].ic_from + '&client=' + response[i].ic_fromname + '&tab=' + tab);
        //         }
        //         $('#tbodyid').html(htmltab);

        //         // Example: Update a specific section with the response data
        //         $('#content-area').html(response);
        //     },
        //     error: function (xhr, status, error) {
        //         // Handle errors
        //         console.error('Error:', error);
        //     }
        // });

        $.ajax({
            url: '/InboxClient/fetchdetails', // Controller action URL
            type: 'POST',             // HTTP method
            data: data,
            // Data to send (query parameter)
            success: function (response) {
                // Handle success - update the page dynamically
                console.log('Response:', response);
                $('#detailsTableBody').html('');
                var htmltab = '';
                for (var i = 0; i < response.sentclientList.length; i++) {
                    htmltab += '<tr>';
                    htmltab += '<td onclick="inboxmsg(' + response.sentclientList[i].ic_id + ')">' + (i + 1) + '</td>';
                    htmltab += '<td style="display:none">' + response.sentclientList[i].ic_id + '</td>';
                    htmltab += '<td onclick="inboxmsg(' + response.sentclientList[i].ic_id + ')">' + response.sentclientList[i].ic_from + '</td>';
                    htmltab += '<td onclick="inboxmsg(' + response.sentclientList[i].ic_id + ')">' + response.sentclientList[i].ic_to + '</td>';
                    htmltab += '<td onclick="inboxmsg(' + response.sentclientList[i].ic_id + ')">' + response.sentclientList[i].ic_subject + '</td>';
                    htmltab += '<td onclick="inboxmsg(' + response.sentclientList[i].ic_id + ')">' + response.sentclientList[i].ic_receiveddate + '</td>';
                    // htmltab += '<td >' + response[i].ic_attachment + '</td>';


                    if (response.sentclientList[i].ic_attachment != "No attachments available.") {
                        htmltab += '<td style="width:4%" ><i class="fa fa-paperclip" aria-hidden="true"></i></td>';
                    }
                    else {
                        htmltab += '<td style="width:4%"></td>';
                    }
                    //htmltab += '<td><i class="fas fa-eye text-primary" onclick="inboxmsg('+response[i].sc_toemail+')"></i></td>';
                    htmltab += '<td style="display:none"><i class="fas fa-eye text-primary" onclick="inboxmsg(' + response.sentclientList[i].ic_id + ')"></i></td>';

                    htmltab += '</tr>';


                }
                $('#detailsTableBody').html(htmltab);

                // Example: Update a specific section with the response data
                $('#content-area').html(response);

            },
            error: function (xhr, status, error) {
                // Handle errors
                console.error('Error:', error);
            }
        });
    }

    function claimtab() {
        $('#custom-search').val('');

        $('#detailsGrid').css('display', 'block');
        $('#attachGrid').css('display', 'none');
        $('#dataTable4').show();
        $('#dataTable2').hide();
        $('#dataTable3').hide();

        $('#detailsTableBody1').css('display', 'contents');
        $('#detailsTableBody').css('display', 'none');


        $('#claimnodiv').css('display', 'contents');

        var tab = "claim";
        $('#enquiry-tab').attr('aria-selected', 'false');
        $('#client-tab').attr('aria-selected', 'false');
        $('#claim-tab').attr('aria-selected', 'true');
        $('#general-tab').attr('aria-selected', 'true');
        $('#enquiry-atttab').attr('aria-selected', 'false');
        $('#claim-atttab').attr('aria-selected', 'false');

        $('#enquiry-tab').attr('class', 'nav-link');
        $('#client-tab').attr('class', 'nav-link');
        $('#claim-tab').attr('class', 'nav-link active');
        $('#general-tab').attr('class', 'nav-link');
        $('#enquiry-atttab').attr('class', 'nav-link ');
        $('#claim-atttab').attr('class', 'nav-link ');

        // var urlParams = new URLSearchParams(window.location.search);
        // var email = urlParams.get('email');

        //var email = $('#clientDropdown1').val();
        //var email = $('#clientDropdown1 option:selected').text();
        var urlParams = new URLSearchParams(window.location.search);
        var email = urlParams.get('email');
        var year = $('#yearDropdown option:selected').text();

        var data = {
            ic_from: email,
            tab: tab,
            ic_year: year,
        };

        $.ajax({
            url: '/InboxClient/fetchdetails', // Controller action URL
            type: 'POST',             // HTTP method
            data: data,
            // Data to send (query parameter)
            success: function (response) {
                // Handle success - update the page dynamically
                console.log('Response:', response);
                $('#detailsTableBody1').html('');
                var htmltab = '';
                for (var i = 0; i < response.sentclientList.length; i++) {
                    htmltab += '<tr>';
                    htmltab += '<td onclick="inboxmsg(' + response.sentclientList[i].ic_id + ')">' + (i + 1) + '</td>';
                    htmltab += '<td onclick="inboxmsg(' + response.sentclientList[i].ic_id + ')">' + response.sentclientList[i].ic_claimno + '</td>';
                    htmltab += '<td style="display:none">' + response.sentclientList[i].ic_id + '</td>';
                    htmltab += '<td onclick="inboxmsg(' + response.sentclientList[i].ic_id + ')">' + response.sentclientList[i].ic_from + '</td>';
                    htmltab += '<td onclick="inboxmsg(' + response.sentclientList[i].ic_id + ')">' + response.sentclientList[i].ic_to + '</td>';
                    htmltab += '<td onclick="inboxmsg(' + response.sentclientList[i].ic_id + ')">' + response.sentclientList[i].ic_subject + '</td>';
                    htmltab += '<td onclick="inboxmsg(' + response.sentclientList[i].ic_id + ')">' + response.sentclientList[i].ic_receiveddate + '</td>';
                    // htmltab += '<td >' + response[i].ic_attachment + '</td>';

                    if (response.sentclientList[i].ic_attachment != "No attachments available.") {
                        htmltab += '<td style="width:4%" ><i class="fa fa-paperclip" aria-hidden="true"></i></td>';
                    }
                    else {
                        htmltab += '<td style="width:4%"></td>';
                    }

                    //htmltab += '<td><i class="fas fa-eye text-primary" onclick="inboxmsg('+response[i].sc_toemail+')"></i></td>';
                    htmltab += '<td style="display:none"><i class="fas fa-eye text-primary" onclick="inboxmsg(' + response.sentclientList[i].ic_id + ')"></i></td>';

                    htmltab += '</tr>';




                    const claimDropdown = document.getElementById('claimdropdown');

                    $('#claimdropdown').html('<option>--Select--</option>');


                    // Loop through the claimno array and add each as an option to the dropdown
                    response.claimno.forEach(claim => {
                        const option = document.createElement('option');

                        option.value = claim.id;  // Set the id as the value of the option
                        option.text = claim.value;  // Set the value as the display text
                        claimDropdown.appendChild(option);
                    });


                }
                $('#detailsTableBody1').html(htmltab);

                // Example: Update a specific section with the response data
                $('#content-area').html(response);



            },
            error: function (xhr, status, error) {
                // Handle errors
                console.error('Error:', error);
            }
        });
    }

    function enquiryatttab() {
        $('#custom-search').val('');
        $('#dataTable3').show();
        $('#dataTable2').hide();
        $('#datatable3head').show();

        $('#detailsGrid').css('display', 'none');
        $('#attachGrid').css('display', 'block');
        var tab = "enquiry";
        $('#enquiry-tab').attr('aria-selected', 'false');
        $('#client-tab').attr('aria-selected', 'false');
        $('#claim-tab').attr('aria-selected', 'false');
        $('#general-tab').attr('aria-selected', 'false');
        $('#enquiry-atttab').attr('aria-selected', 'true');
        $('#claim-atttab').attr('aria-selected', 'false');

        $('#enquiry-tab').attr('class', 'nav-link');
        $('#client-tab').attr('class', 'nav-link');
        $('#claim-tab').attr('class', 'nav-link');
        $('#general-tab').attr('class', 'nav-link');
        $('#claim-atttab').attr('class', 'nav-link');
        $('#enquiry-atttab').attr('class', 'nav-link active');
        $('#dataTable2').hide();

        $('#claimnodiv').css('display', 'none');

        // var urlParams = new URLSearchParams(window.location.search);
        // var email = urlParams.get('email');

        //var email = $('#clientDropdown1').val();
        var email = $('#clientDropdown1 option:selected').text();
        var urlParams = new URLSearchParams(window.location.search);
        var email = urlParams.get('email');
        var year = $('#yearDropdown option:selected').text();

        var data = {

            tab: tab,
            ic_year: year,
            ic_from: email
        };

        $.ajax({
            url: '/InboxClient/FetchAttachments', // Controller action URL
            type: 'POST',             // HTTP method
            data: data,
            // Data to send (query parameter)
            success: function (response) {
                // Handle success - update the page dynamically
                console.log('Response:', response);
                $('#attachTableBody').html('');
                var htmltab = '';
                for (var i = 0; i < response.length; i++) {
                    htmltab += '<tr>';
                    htmltab += '<td>' + (i + 1) + '</td>';
                    htmltab += '<td style="display:none">' + response[i].ic_id + '</td>';

                    htmltab += '<td >' + response[i].ic_attachment + '</td>';

                    //htmltab += '<td><i class="fas fa-download text-primary" onclick="downloadFile(' + response[i].icc_attachment + ')" ></i></td>';

                    var filePath = response[i].icc_attachment.replace(/\\/g, '\\\\'); // Escape backslashes
                    htmltab += '<td><i class="fas fa-download text-primary" onclick="downloadFile(\'' + filePath + '\')"></i></td>';
                    htmltab += '</tr>';


                }
                $('#attachTableBody').html(htmltab);

                // Example: Update a specific section with the response data
                $('#content-area').html(response);



            },
            error: function (xhr, status, error) {
                // Handle errors
                console.error('Error:', error);
            }
        });
    }

    function claimatttab() {
        $('#custom-search').val('');
        $('#dataTable3').show();
        $('#dataTable2').hide();
        $('#datatable3head').show();

        $('#detailsGrid').css('display', 'none');
        $('#attachGrid').css('display', 'block');
        var tab = "claim";
        $('#enquiry-tab').attr('aria-selected', 'false');
        $('#client-tab').attr('aria-selected', 'false');
        $('#claim-tab').attr('aria-selected', 'false');
        $('#general-tab').attr('aria-selected', 'false');
        $('#enquiry-atttab').attr('aria-selected', 'false');
        $('#claim-atttab').attr('aria-selected', 'true');

        $('#enquiry-tab').attr('class', 'nav-link');
        $('#client-tab').attr('class', 'nav-link');
        $('#claim-tab').attr('class', 'nav-link');
        $('#general-tab').attr('class', 'nav-link');
        $('#claim-atttab').attr('class', 'nav-link active');
        $('#enquiry-atttab').attr('class', 'nav-link ');
        $('#dataTable2').hide();

        $('#claimnodiv').css('display', 'none');


        // var urlParams = new URLSearchParams(window.location.search);
        // var email = urlParams.get('email');

        //var email = $('#clientDropdown1').val();
        //var email = $('#clientDropdown1 option:selected').text();


        var email = $('#clientDropdown1 option:selected').text();



        var urlParams = new URLSearchParams(window.location.search);
        var email = urlParams.get('email');
        var year = $('#yearDropdown option:selected').text();

        var data = {

            tab: tab,
            ic_year: year,
            ic_from: email
        };

        $.ajax({
            url: '/InboxClient/FetchAttachments', // Controller action URL
            type: 'POST',             // HTTP method
            data: data,
            // Data to send (query parameter)
            success: function (response) {
                // Handle success - update the page dynamically
                console.log('Response:', response);
                $('#attachTableBody').html('');
                var htmltab = '';
                for (var i = 0; i < response.length; i++) {
                    htmltab += '<tr>';
                    htmltab += '<td>' + (i + 1) + '</td>';
                    htmltab += '<td style="display:none">' + response[i].ic_id + '</td>';

                    htmltab += '<td >' + response[i].ic_attachment + '</td>';

                    //htmltab += '<td><i class="fas fa-download text-primary" onclick="downloadFile(' + response[i].icc_attachment + ')" ></i></td>';

                    var filePath = response[i].icc_attachment.replace(/\\/g, '\\\\'); // Escape backslashes
                    htmltab += '<td><i class="fas fa-download text-primary" onclick="downloadFile(\'' + filePath + '\')"></i></td>';
                    htmltab += '</tr>';


                }
                $('#attachTableBody').html(htmltab);

                // Example: Update a specific section with the response data
                $('#content-area').html(response);



            },
            error: function (xhr, status, error) {
                // Handle errors
                console.error('Error:', error);
            }
        });
    }
    //     function claimtab() {
    //     var tab = "claim";
    //     $('#enquiry-tab').attr('aria-selected', 'false');
    //     $('#client-tab').attr('aria-selected', 'false');
    //     $('#claim-tab').attr('aria-selected', 'true');
    //     $('#general-tab').attr('aria-selected', 'true');

    //     $('#enquiry-tab').attr('class', 'nav-link');
    //     $('#client-tab').attr('class', 'nav-link');
    //     $('#claim-tab').attr('class', 'nav-link active');
    //     $('#general-tab').attr('class', 'nav-link');

    //     var urlParams = new URLSearchParams(window.location.search);
    //     var email = urlParams.get('email');
    //     var year = $('#yearDropdown option:selected').text();

    //     var data = {
    //         ic_from: email,
    //         tab: tab,
    //         ic_year: year,
    //     };

    //     $.ajax({
    //         url: '/InboxClient/fetchdetails', // Controller action URL
    //         type: 'POST',             // HTTP method
    //         data: data,
    //         success: function (response) {
    //             console.log('Response:', response);
    //             $('#detailsTableBody').html('');

    //             var htmltab = '';
    //             for (var i = 0; i < response.length; i++) {
    //                 htmltab += '<tr>';
    //                 htmltab += '<td>' + (i + 1) + '</td>';
    //                 htmltab += '<td style="display:none">' + response[i].ic_id + '</td>';
    //                 htmltab += '<td>' + response[i].ic_from + '</td>';
    //                 htmltab += '<td>' + response[i].ic_to + '</td>';
    //                 htmltab += '<td>' + response[i].ic_subject + '</td>';
    //                 htmltab += '<td>' + response[i].ic_receiveddate + '</td>';
    //                 htmltab += '<td >' + response[i].ic_attachment + '</td>';
    //                 htmltab += '<td><i class="fas fa-eye text-primary" onclick="inboxmsg(' + response[i].ic_id + ')"></i></td>';
    //                 htmltab += '</tr>';
    //             }

    //             // Add entries selector and pagination
    //             var controlPanel = `
    //                 <div class="row mt-3">
    //                     <div class="col-lg-5 col-md-5 col-12">
    //                         <div class="row">
    //                             <div class="col-lg-3 col-md-3 col-12 d-flex justify-content-lg-start justify-content-md-start justify-content-center">
    //                                 <h6 class="mt-2">Show</h6>&nbsp;&nbsp;
    //                                 <select name="table_id_length" id="table_length_select2" class="form-select w-auto">
    //                                     <option value="10">10</option>
    //                                     <option value="25">25</option>
    //                                     <option value="50">50</option>
    //                                     <option value="100">100</option>
    //                                 </select>
    //                                 &nbsp;&nbsp;
    //                                 <h6 class="mt-2">entries</h6>
    //                             </div>
    //                         </div>
    //                     </div>
    //                     <div class="col-lg-2 col-md-2"></div>
    //                     <div class="col-lg-5 col-md-5 col-12 mt-lg-0 mt-md-0 mt-3">
    //                         <nav aria-label="Page navigation example">
    //                             <div id="table_id_length2">
    //                                 <div id="dataTable2-custom-pagination" class="d-flex text-center text-lg-end justify-content-end text-end float-end">
    //                                     <ul class="pagination justify-content-lg-end justify-content-md-end justify-content-center">
    //                                         <li class="page-item disabled">
    //                                             <button class="page-link" href="#" data-page="0"><span>&laquo;</span></button>
    //                                         </li>
    //                                         <li class="page-item active">
    //                                             <button class="page-link" href="#" data-page="1">1</button>
    //                                         </li>
    //                                         <li class="page-item">
    //                                             <button class="page-link" href="#" data-page="2"><span>&raquo;</span></button>
    //                                         </li>
    //                                     </ul>
    //                                 </div>
    //                             </div>
    //                         </nav>
    //                     </div>
    //                 </div>
    //             `;

    //             // Update table and add control panel before it
    //                 $('#content-area').html(controlPanel + '<table id="dataTable2" class="table table-striped"><thead><tr><th>#</th><th>From</th><th>To</th><th>Subject</th><th>Received Date</th><th>Attachment</th><th>Actions</th></tr></thead><tbody>' + htmltab + '</tbody></table>');

    //             // Initialize DataTables
    //                // $('#dataTable2').DataTable();
    //         },
    //         error: function (xhr, status, error) {
    //             console.error('Error:', error);
    //         }
    //     });
    // }


    function generaltab() {
        var tab = "General";
        $('#enquiry-tab').attr('aria-selected', 'false');
        $('#client-tab').attr('aria-selected', 'false');
        $('#claim-tab').attr('aria-selected', 'false');
        $('#general-tab').attr('aria-selected', 'true');

        $.ajax({
            url: '/InboxClient/general?tab=' + tab,
            type: 'POST',
            data: { tab: tab },
            success: function (response) {

                console.log('Response:', response);
                $('#tbodyid').html('');
                var htmltab = '';
                for (var i = 0; i < response.length; i++) {
                    htmltab += '<tr>';
                    htmltab += '<td>' + (i + 1) + '</td>';
                    htmltab += '<td style=display:none>' + response[i].ic_from + '</td>';
                    htmltab += '<td style=display:none>' + response[i].ic_fromname + '</td>';
                    htmltab += '<td onclick="show(\'' + response[i].ic_year + '\', \'' + response[i].ic_fromname + '\', \'' + response[i].ic_from + '\')">' + response[i].ic_year + '</td>';
                    htmltab += '<td>' + response[i].ic_count + '</td>';
                    htmltab += '</tr>';

                    // window.location.search = '?email=' + response[i].sc_to + '&client=' + response[i].sc_toname + '&tab=' + tab;
                    history.pushState(null, '', '?email=' + ic_from + '&client=' + ic_fromname + '&tab=' + tab);
                }
                $('#tbodyid').html(htmltab);
                $('#content-area').html(response);
            },
            error: function (xhr, status, error) {
                console.error('Error:', error);
            }
        });
    }

    function filter() {
        $("#addfilter").modal("show");
    }
    function submitfilter() {


        $('#enquiry-tab').attr('aria-selected', 'false');
        $('#client-tab').attr('aria-selected', 'false');
        $('#claim-tab').attr('aria-selected', 'false');
        $('#general-tab').attr('aria-selected', 'false');


        $('#enquiry-tab').attr('class', 'nav-link');
        $('#client-tab').attr('class', 'nav-link');
        $('#claim-tab').attr('class', 'nav-link');
        $('#general-tab').attr('class', 'nav-link');

        $('#' + tab + '-tab').attr('aria-selected', 'true');
        $('#' + tab + '-tab').attr('class', 'nav-link active');


        if (tab == 'client') {
            tab = "insurance";
        }

        $("#addfilter").modal("hide");
        var from = $('#i_from').val() || "";
        var to = $('#i_to').val() || "";
        var subject = $('#i_subject').val() || "";
        var hasthewords = $('#i_hasthewords').val() || "";
        var tab = $('#i_tab').val() || "";
        var year = $('#yearDropdown1 option:selected').text() || "";


        var data = {
            from: from,
            to: to,
            subject: subject,
            hasthewords: hasthewords,
            tab: tab,
            year: year,

        };

        if (tab == "enquiry" || tab == "insurance") {
            $('#detailsGrid').css('display', 'block');
            $('#attachGrid').css('display', 'none');
            $('#dataTable2').show();
            $('#dataTable3').hide();
            $('#dataTable4').hide();
            $('#detailsTableBody').css('display', 'contents');
            $('#detailsTableBody1').css('display', 'none');


            $('#claimnodiv').css('display', 'none');

            $('#enquiry-tab').attr('aria-selected', 'true');
            $('#enquiry-tab').attr('class', 'nav-link active');

            $.ajax({
                url: '/InboxClient/filter?from=' + from + 'to=' + to + 'subject' + subject + 'hasthewords=' + hasthewords + 'year=' + year + 'tab=' + tab, // Controller action URL
                type: 'POST',             // HTTP method
                data: data,      // Data to send (query parameter)
                success: function (response) {
                    // Handle success - update the page dynamically
                    console.log('Response:', response);
                    $('#detailsTableBody').html('');
                    var htmltab = '';
                    for (var i = 0; i < response.length; i++) {

                        htmltab += '<tr>';
                        htmltab += '<td onclick="inboxmsg(' + response[i].ic_id + ')">' + (i + 1) + '</td>';
                        htmltab += '<td style="display:none">' + response[i].ic_id + '</td>';
                        htmltab += '<td onclick="inboxmsg(' + response[i].ic_id + ')">' + response[i].ic_from + '</td>';
                        htmltab += '<td onclick="inboxmsg(' + response[i].ic_id + ')">' + response[i].ic_to + '</td>';
                        htmltab += '<td onclick="inboxmsg(' + response[i].ic_id + ')">' + response[i].ic_subject + '</td>';
                        htmltab += '<td onclick="inboxmsg(' + response[i].ic_id + ')">' + response[i].ic_receiveddate + '</td>';
                        // htmltab += '<td >' + response[i].ic_attachment + '</td>';

                        if (response[i].ic_attachment != "No attachments available.") {
                            htmltab += '<td style="width:4%" ><i class="fa fa-paperclip" aria-hidden="true"></i></td>';
                        }
                        else {
                            htmltab += '<td style="width:4%"></td>';
                        }

                        //htmltab += '<td><i class="fas fa-eye text-primary" onclick="inboxmsg('+response[i].sc_toemail+')"></i></td>';
                        htmltab += '<td style="display:none"><i class="fas fa-eye text-primary" onclick="inboxmsg(' + response[i].ic_id + ')"></i></td>';

                        htmltab += '</tr>';
                    }
                    $('#detailsTableBody').html(htmltab);

                    // Example: Update a specific section with the response data
                    $('#content-area').html(response);
                },
                error: function (xhr, status, error) {
                    // Handle errors
                    console.error('Error:', error);
                }
            });
            $('#i_from').val('');
            $('#i_to').val('');
            $('#i_subject').val('');
            $('#i_hasthewords').val('');
            $('#i_tab').val('');
            $('#yearDropdown1').val('');
        }
        else {
            $('#claim-tab').attr('aria-selected', 'true');
            $('#claim-tab').attr('class', 'nav-link active');
            $('#detailsTableBody').css('display', 'none');
            $('#detailsGrid').css('display', 'block');
            $('#attachGrid').css('display', 'none');
            $('#dataTable4').show();
            $('#dataTable2').hide();
            $('#dataTable3').hide();
            $('#detailsTableBody1').css('display', 'contents');

            $('#claimnodiv').css('display', 'contents');

            $.ajax({
                url: '/InboxClient/filter?from=' + from + 'to=' + to + 'subject' + subject + 'hasthewords=' + hasthewords + 'year=' + year + 'tab=' + tab, // Controller action URL
                type: 'POST',             // HTTP method
                data: data,      // Data to send (query parameter)
                success: function (response) {
                    // Handle success - update the page dynamically
                    console.log('Response:', response);
                    $('#detailsTableBody1').html('');
                    var htmltab = '';
                    for (var i = 0; i < response.length; i++) {

                        htmltab += '<tr>';
                        htmltab += '<td onclick="inboxmsg(' + response[i].ic_id + ')">' + (i + 1) + '</td>';
                        htmltab += '<td style="display:none">' + response[i].ic_id + '</td>';
                        htmltab += '<td onclick="inboxmsg(' + response[i].ic_id + ')">' + response[i].ic_claimno + '</td>';
                        htmltab += '<td onclick="inboxmsg(' + response[i].ic_id + ')">' + response[i].ic_from + '</td>';
                        htmltab += '<td onclick="inboxmsg(' + response[i].ic_id + ')">' + response[i].ic_to + '</td>';
                        htmltab += '<td onclick="inboxmsg(' + response[i].ic_id + ')">' + response[i].ic_subject + '</td>';
                        htmltab += '<td onclick="inboxmsg(' + response[i].ic_id + ')">' + response[i].ic_receiveddate + '</td>';
                        // htmltab += '<td >' + response[i].ic_attachment + '</td>';

                        if (response[i].ic_attachment != "No attachments available.") {
                            htmltab += '<td style="width:4%" ><i class="fa fa-paperclip" aria-hidden="true"></i></td>';
                        }
                        else {
                            htmltab += '<td style="width:4%"></td>';
                        }

                        //htmltab += '<td><i class="fas fa-eye text-primary" onclick="inboxmsg('+response[i].sc_toemail+')"></i></td>';
                        htmltab += '<td style="display:none"><i class="fas fa-eye text-primary" onclick="inboxmsg(' + response[i].ic_id + ')"></i></td>';

                        htmltab += '</tr>';
                    }
                    $('#detailsTableBody1').html(htmltab);

                    // Example: Update a specific section with the response data
                    $('#content-area').html(response);
                },
                error: function (xhr, status, error) {
                    // Handle errors
                    console.error('Error:', error);
                }
            });
            $('#i_from').val('');
            $('#i_to').val('');
            $('#i_subject').val('');
            $('#i_hasthewords').val('');
            $('#i_tab').val('');
            $('#yearDropdown1').val('');
        }
    }


    function claimdropdown() {

        $('#detailsgridname').css('display', 'none');
        $('#detailsGrid').css('display', 'none');

        // var urlParams = new URLSearchParams(window.location.search);
        // var tab = urlParams.get('tab');
        var year = $('#yearDropdown option:selected').text();
        var claim = $('#claimdropdown option:selected').text();

        $('#detailsgridname').css('display', 'block');
        $('#detailsGrid').css('display', 'block');


        if ($('#enquiry-tab').hasClass('active')) {
            tab = "Enquiry";
        }
        else {
            tab = "Claim";
        }

        var clientid = $('#clientDropdown1').val();
        var data = {
            clientid: clientid,
            tab: tab,
            year: year,
            claim: claim,
        };


        if ($('#enquiry-tab').hasClass('active')) {
            tab = "Enquiry";

            $('#dataTable4').hide();


            $.ajax({
                url: '/InboxClient/ClaimNo', // Controller action URL
                type: 'POST',             // HTTP method
                data: data,
                success: function (response) {
                    console.log(response);

                    // If the response length is 0, do not update the table or URL
                    if (response.length === 0) {
                        // alert("no data");
                        $('#detailsTableBody').html('');
                        return; // Exit the function early
                    }

                    // Make details grid visible when there is data

                    $('#detailsTableBody').html('');  // Clear previous table content

                    var htmltab = '';
                    for (var i = 0; i < response.length; i++) {
                        htmltab += '<tr>';
                        htmltab += '<td onclick="inboxmsg(' + response[i].ic_id + ')">' + (i + 1) + '</td>';
                        htmltab += '<td style="display:none">' + response[i].ic_id + '</td>';
                        htmltab += '<td onclick="inboxmsg(' + response[i].ic_id + ')">' + response[i].ic_from + '</td>';
                        htmltab += '<td onclick="inboxmsg(' + response[i].ic_id + ')">' + response[i].ic_to + '</td>';
                        htmltab += '<td onclick="inboxmsg(' + response[i].ic_id + ')">' + response[i].ic_subject + '</td>';
                        htmltab += '<td onclick="inboxmsg(' + response[i].ic_id + ')">' + response[i].ic_receiveddate + '</td>';
                        // htmltab += '<td >' + response[i].ic_attachment + '</td>';

                        if (response[i].ic_attachment != "No attachments available.") {
                            htmltab += '<td style="width:4%" ><i class="fa fa-paperclip" aria-hidden="true"></i></td>';
                        }
                        else {
                            htmltab += '<td style="width:4%"></td>';
                        }

                        htmltab += '<td style="display:none"><i class="fas fa-eye text-primary" onclick="inboxmsg(' + response[i].ic_id + ')"></i></td>';
                        htmltab += '</tr>';
                    }

                    // Update the table body with new data
                    $('#detailsTableBody').html(htmltab);

                    // Example: Update a specific section with the response data (if any)
                    $('#content-area').html(response);
                },
                error: function (xhr, status, error) {
                    // Handle errors
                    console.error('Error:', error);
                }
            });
        }

        else {
            tab = "Claim";
            $('#dataTable4').show();

            $.ajax({
                url: '/InboxClient/ClaimNo', // Controller action URL
                type: 'POST',             // HTTP method
                data: data,
                success: function (response) {
                    console.log(response);

                    // If the response length is 0, do not update the table or URL
                    if (response.length === 0) {
                        // alert("no data");
                        $('#detailsTableBody1').html('');
                        return; // Exit the function early
                    }

                    // Make details grid visible when there is data

                    $('#detailsTableBody1').html('');  // Clear previous table content

                    var htmltab = '';
                    for (var i = 0; i < response.length; i++) {
                        htmltab += '<tr>';
                        htmltab += '<td onclick="inboxmsg(' + response[i].ic_id + ')">' + (i + 1) + '</td>';
                        htmltab += '<td onclick="inboxmsg(' + response[i].ic_id + ')">' + response[i].ic_claimno + '</td>';
                        htmltab += '<td style="display:none">' + response[i].ic_id + '</td>';
                        htmltab += '<td onclick="inboxmsg(' + response[i].ic_id + ')">' + response[i].ic_from + '</td>';
                        htmltab += '<td onclick="inboxmsg(' + response[i].ic_id + ')">' + response[i].ic_to + '</td>';
                        htmltab += '<td onclick="inboxmsg(' + response[i].ic_id + ')">' + response[i].ic_subject + '</td>';
                        htmltab += '<td onclick="inboxmsg(' + response[i].ic_id + ')">' + response[i].ic_receiveddate + '</td>';
                        // htmltab += '<td >' + response[i].ic_attachment + '</td>';

                        if (response[i].ic_attachment != "No attachments available.") {
                            htmltab += '<td style="width:4%" ><i class="fa fa-paperclip" aria-hidden="true"></i></td>';
                        }
                        else {
                            htmltab += '<td style="width:4%"></td>';
                        }

                        htmltab += '<td style="display:none"><i class="fas fa-eye text-primary" onclick="inboxmsg(' + response[i].ic_id + ')"></i></td>';
                        htmltab += '</tr>';
                    }

                    // Update the table body with new data
                    $('#detailsTableBody1').html(htmltab);

                    // Example: Update a specific section with the response data (if any)
                    $('#content-area').html(response);
                },
                error: function (xhr, status, error) {
                    // Handle errors
                    console.error('Error:', error);
                }
            });
        }

        var client = $('#clientDropdown1').val();

        // Match the text in the dropdown options and set the value
        if (client) {
            $('#clientDropdown1 option').each(function () {
                if ($(this).val() == client) {
                    $('#clientDropdown1').val($(this).val());
                }
            });
        }
    }


</script>


