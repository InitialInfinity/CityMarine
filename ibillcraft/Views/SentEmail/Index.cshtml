@using Microsoft.AspNetCore.Mvc.Localization;
@using Microsoft.Extensions.Localization;
@using System.Globalization;
@inject IViewLocalizer Localizer;
@model IEnumerable<ibillcraft.Models.SentEmailModel>
@{

    ViewData["Title"] = "Sent Email";
    ViewBag.Header = "Sent Email";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    * {
        box-sizing: border-box;
    }

    .flex-container {
        display: flex;
        width: 100%;
        gap: 10px;
    }

    .box {
        padding: 15px;
        border: 1px solid;
    }

        .box:first-child {
            flex: 2; /* First box will take twice the space compared to the second */
        }

        .box:nth-child(2) {
            flex: 1; /* Second box will take normal space */
        }

    .buttons {
        margin-top: 20px;
        padding-left: 40%;
    }

    .attachments, .conversation {
        margin-top: 20px;
    }
    /* arrow */
    .arrow-container {
        background-color: #4a4747;
        padding: 10px;
        width: 100px;
        color: white;
        font-family: Arial, sans-serif;
    }

    .arrow-item {
        background-color: #d3d3d3;
        color: black;
        padding: 4px;
        position: relative;
        margin-bottom: 15px;
        font-size: 14px;
        text-align: center;
        border-radius: 3px;
    }

        .arrow-item::after {
            content: '';
            position: absolute;
            top: 53%;
            right: -26px;
            transform: translateY(-50%);
            border-width: 14px;
            border-style: solid;
            border-color: transparent transparent transparent #d3d3d3;
        }
</style>

<div class="card shadow mb-4">
    <div class="card-header py-3">
        <div class="row align-items-center">
            <div class="col">
                <h2 class="m-0 font-weight-bold text-primary">@Localizer["Sent"]</h2>
            </div>
            <div class="col-md-2 justify-content-lg-end justify-content-md-end justify-content-center mt-lg-0 mt-md-0 mt-3">
                <input type="text" id="custom-search" class="form-control" placeholder="@Localizer["Search"]" />
            </div>
            <div class="col-auto d-flex flex-wrap toggle">
                <button class="btn btn-md text-light bg-primary mt-3 mt-lg-0 mt-md-0 ml-2" onclick="return filter()"
                        type="button" title="Filter">
                    <i class="fa-solid fa-filter"></i>
                </button>
            </div>
            <div class="col-auto d-flex flex-wrap toggle" style="display:none">
                <a class="btn btn-md text-light float-end bg-success mt-3 mt-lg-0 mt-md-0 ml-2" asp-action="Index" asp-controller="SentEmail"
                   title="Sync" type="button">
                    <i class="fas fa-sync-alt" style="font-size:18px"></i>
                </a>



            </div>

        </div>
    </div>

    <ul class="nav nav-tabs" id="tabMenu" role="tablist">
        <li class="nav-item">
            <button class="nav-link active" id="client-tab" data-bs-toggle="tab" data-bs-target="#client" type="button" role="tab" aria-controls="client" onclick="return clienttab()">
                Client
            </button>
        </li>
        <li class="nav-item" style="display:none;">
            <button class="nav-link" id="enquiry-tab" data-bs-toggle="tab" data-bs-target="#enquiry" type="button" role="tab" aria-controls="enquiry" onclick="return enquirytab()">
                Enquiry
            </button>
        </li>
        <li class="nav-item" style="display:none;">
            <button class="nav-link" id="claim-tab" data-bs-toggle="tab" data-bs-target="#claim" type="button" role="tab" aria-controls="claim" onclick="return claimtab()">
                Claim
            </button>
        </li>
        <li class="nav-item">
            <button class="nav-link" id="general-tab" data-bs-toggle="tab" data-bs-target="#general" type="button" role="tab" aria-controls="general" onclick="return generaltab()">
                General
            </button>
        </li>
    </ul>


    <div class="modal fade" id="addfilter" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
         style="display:none">
        <div class="modal-dialog modal-md" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-dark fw-bold" style="font-size: larger;" id="exampleModalLabel">Filter</h5>
                    <button type="button"
                            class="btn-close bg-danger modal-close"
                            data-bs-dismiss="modal"
                            aria-label="Close"></button>
                </div>
                <div class="modal-body text-dark" style=" background-color: #f8f9fa;padding: 15px;border-radius: 8px;">
                    @*   <div class="flex-container"> *@
                    @*  <div class="box" style="background-color: #ffffff;border: 1px solid #ddd;box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);"> *@
                    <div class="row">
                        <div class="col-xs-6 col-sm-6 col-md-12 ">
                            <div class="form-group form-group-sm">
                                <label class="control-label fw-bold" style="font-size: larger;" for="from">From</label>
                                <span style="padding-left:40px"><input type="text" class="form-control" id="s_from" style="font-size:medium" /></span>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-6 col-sm-6 col-md-12 ">
                            <div class="form-group form-group-sm">
                                <label class="control-label fw-bold" style="font-size: larger;" for="to">To</label>
                                <span style="padding-left:59px"><input type="text" class="form-control" id="s_to" value="" style="font-size:medium" /></span>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-6 col-sm-6 col-md-12 ">
                            <div class="form-group form-group-sm">
                                <label class="control-label fw-bold" style="font-size: larger;" for="subject">Subject</label>
                                <span style="padding-left:23px"><input type="text" class="form-control" id="s_subject" value="" style="font-size:medium" /></span>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-6 col-sm-6 col-md-12 ">
                            <div class="form-group form-group-sm">
                                <label class="control-label fw-bold" style="font-size: larger;" for="subject">Has the words</label>
                                <span style="padding-left:23px"><input type="text" class="form-control" id="s_hasthewords" value="" style="font-size:medium" /></span>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-6 col-sm-6 col-md-12 ">
                            <div class="form-group form-group-sm">
                                <label class="control-label fw-bold" style="font-size: larger;" for="subject">Search</label>
                                <select class="form-select" id="s_tab">
                                    <option value="client">Client</option>
                                    @*  <option value="enquiry">Enquiry</option>
                                    <option value="claim">Claim</option> *@
                                    <option value="general">General</option>
                                </select>
                            </div>
                        </div>
                        @*     </div> *@
                    </div>

                </div>
                <div class="modal-footer">
                    <button title="Save" type="submit" id="btnsubmit" value="Create" class="btn btn-primary" onclick="submitfilter()">@Localizer["Submit"]</button>
                    <button type="button" title="Close" class="btn btn-danger" data-dismiss="modal" onclick="CancelData()">@Localizer["Cancel"]</button>
                </div>
            </div>
        </div>
    </div>

    @*  <div class="modal fade" id="addSubscription" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    <div class="modal-dialog modal-xl" role="document">
    <div class="modal-content">
    <div class="modal-header">
    <h5 class="modal-title text-dark fw-bold" style="font-size: larger;" id="exampleModalLabel">Email</h5>
    <button type="button"
    class="btn-close bg-danger modal-close"
    data-bs-dismiss="modal"
    aria-label="Close"></button>
    </div>
    <div class="modal-body text-dark" style=" background-color: #f8f9fa;padding: 15px;border-radius: 8px;">
    <div class="flex-container">
    <div class="box" style="background-color: #ffffff;border: 1px solid #ddd;box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);">
    <div class="form-group">
    <label class="control-label fw-bold" style="font-size: larger;" for="from">From:</label>
    <span style="padding-left:40px"><label id="sc_fromlabel" value="" style="font-size:medium"></label></span>
    </div>

    <div class="form-group">
    <label class="control-label fw-bold" style="font-size: larger;" for="to">To:</label>
    <span style="padding-left:59px"><label id="sc_tolabel" value="" style="font-size:medium"></label></span>
    </div>

    <div class="form-group">
    <label class="control-label fw-bold" style="font-size: larger;" for="subject">Subject:</label>
    <span style="padding-left:23px"><label id="sc_subjectlabel" value="" style="font-size:medium"></label></span>
    </div>

    <div class="form-group">
    <label class="control-label fw-bold" for="message" style="display: inline-block; vertical-align: top; margin-right: 10px;font-size: larger;">Message:</label>
    <textarea rows="20" cols="85" readonly id="sc_bodylabel" style="font-size:medium"></textarea>
    </div>

    </div>
    <div class="box" style="background-color: #ffffff;border: 1px solid #ddd;box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);">
    <div class="box" style="background-color: #ffffff;border: 1px solid #ddd;box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);height:50%">
    <div class="attachments">
    <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
    <thead>
    <tr>
    <th colspan="3" style="text-align: left; padding: 10px; font-size: larger; font-weight: bold; border: 1px solid #ddd;">
    Attachments:
    </th>
    </tr>
    </thead>
    <tbody id="viewattachments">
    <tr style=" border: 1px solid #ddd;">
    <td style="padding: 8px;" id="filename"></td>
    <td style="text-align: center;" id="filebuttons1">
    </td>
    <td style="text-align: center;" id="filebuttons2">
    </td>
    </tr>

    </tbody>
    </table>


    </div>
    </div>
    <div class="box" style="background-color: #ffffff;border: 1px solid #ddd;box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);height:50%">
    <div class="conversation">
    <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
    <thead>
    <tr>
    <th colspan="3" style="text-align: left; padding: 10px; font-size: larger; font-weight: bold; border: 1px solid #ddd;">
    Conversation:
    </th>
    </tr>
    </thead>
    <tbody>
    <tr style=" border: 1px solid #ddd;">
    <td class="conversation-item" style="padding: 8px;">  <i class="fas fa-paper-plane" style="color: blue; font-size: 16px;" title="Sent"></i></td>
    <td style="text-align:left;">
    29/09/2024
    </td>
    </tr>
    <tr style=" border: 1px solid #ddd;">
    <td class="conversation-item" style="padding: 8px;">  <i class="fas fa-envelope" style="color: green; font-size: 16px;" title="Received"></i></td>
    <td style="text-align: left;">
    30/09/2024
    </td>
    </tr>
    </tbody>
    </table>
    </div>
    </div>



    </div>


    </div>

    <div class="buttons">
    <button class="btn btn-danger" onclick="CancelData()" type="button" data-dismiss="modal">Close</button>
    </div>
    </div>
    </div>
    </div>
    </div> *@


    @* Start view model *@
    <div class="modal fade" id="addSubscription" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
        <div class="modal-dialog modal-xl" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-dark fw-bold" style="font-size: larger;" id="exampleModalLabel">Email</h5>
                    <button type="button"
                            class="btn-close bg-danger modal-close"
                            data-bs-dismiss="modal"
                            aria-label="Close"></button>
                </div>
                <div class="modal-body text-dark" style=" background-color: #f8f9fa;padding: 15px;border-radius: 8px;">
                    <div class="flex-container">
                        <div style="background-color: #4a4747;border: 1px solid #ddd;box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);margin-bottom: 15px;padding: 15px;width: 11%;max-width: 800px;">
                            <div class="arrow-container" id="arrow-container">
                                @*   <div class="arrow-item" id="date1" ></div>
                                <div style="padding:12px"></div>
                                <div class="arrow-item" id="date2" ></div>
                                <div style="padding:12px"></div>
                                <div class="arrow-item" id="date3" ></div> *@
                            </div>
                        </div>
                        <div class="box" style="background-color: #ffffff;border: 1px solid #ddd;box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);">
                            <div class="form-group">
                                <h3>
                                    <label class="control-label fw-bold" style="font-size: larger;" for="subject">Subject :</label>
                                    <span style="padding-left:23px"><label id="sc_subjectlabel" value="" style="font-size:larger"></label></span>
                                </h3>
                            </div>

                            <div class="form-group">
                                <label class="control-label" style="font-weight:500;" for="from">From :</label>
                                <span style="padding-left:5px"><label id="sc_fromlabel" value="" style="font-size:medium;font-weight:500"></label></span>

                                <label class="" style="font-weight:500;padding-left: 10%;" for="to">To :</label>
                                <span style="padding-left:5px"><label id="sc_tolabel" value="" style="font-size:medium;font-weight:500"></label></span>

                                <div style="width: 100%; height: 1px; background-color: black; margin-top: 5px;"></div>

                            </div>



                            <div class="form-group">
                                @*  <label class="control-label fw-bold" for="message" style="display: inline-block; vertical-align: top; margin-right: 10px;font-size: larger;">Message:</label> *@
                                <textarea rows="20" cols="105" readonly id="sc_bodylabel" style="font-size:medium;border:none"></textarea>
                            </div>

                            @* <div class="attachments" id="attachdiv">
                            <button id="viewattachments" style="display: inline-block;">
                            <div style="padding: 8px;" id="filename"></div>
                            </button>
                            <button style="display: inline-block;height: 42px;width: 40px;">
                            <div style="text-align: center; display: inline-block; " id="filebuttons2"></div>
                            </button>
                            </div>*@

                            <div class="attachments" id="attachdiv" style="display: none;">
                                <button id="viewattachments" style="display: inline-block; padding: 8px;">
                                    <div id="filename"></div>
                                </button>
                                <button id="downloadbutton" style="display: inline-block; height: 42px; width: auto;">
                                    <div id="filebuttons2"></div>
                                </button>
                                <!-- New buttons will be added here -->
                                <div id="additionalButtons"></div>
                            </div>

                        </div>


                    </div>

                    @*  <div class="buttons">
                    <button class="btn btn-danger" onclick="Cancel()" type="button" data-dismiss="modal">Close</button>
                    </div> *@
                </div>
            </div>
        </div>
    </div>


    @* End view model *@

    <div class="card-body">
        <div class="table-responsive" id="print">
            <table class="table table-bordered" id="dataTable1" width="100%" cellspacing="0">
                <thead id="tabhead">
                    <tr>
                        <th width="6%">Sr.No</th>
                        <th>Client Name</th>
                        <th>Last Updated</th>
                    </tr>
                </thead>
                <thead id="tabhead1" style="display:none">
                    <tr>
                        <th width="6%">Sr.No</th>
                        <th style="display:none">id</th>
                        <th>From</th>
                        <th>To</th>
                        <th>Subject</th>
                        <th>Date</th>
                        <th>View</th>
                    </tr>
                </thead>
                <tbody id="tabtable">
                    @{
                        int itemNumber = 1;
                    }
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td>@itemNumber</td>
                            <td>
                                <a href="/SentClient?email=@item.s_from&client=@item.s_fromname&tab=@item.s_type" class="text-primary">
                                    @Html.DisplayFor(modelItem => item.s_fromname)
                                </a>
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.s_sentdate)
                            </td>
                        </tr>
                        itemNumber++;
                    }
                </tbody>
            </table>
        </div>
        <!-- End Griddata-->
        <!-- start Pagination-->
        <div class="row mt-3">
            <div class="col-lg-5 col-md-5 col-12 ">
                <div class="row ">
                    <div class="col-lg-3 col-md-3 col-12 d-flex justify-content-lg-start justify-content-md-start justify-content-center ">
                        <h6 class="mt-2"> @Localizer["Show"]</h6>&nbsp;&nbsp;
                        <select name="table_id_length" id="table_length_select" aria-controls="table_id" class="form-select w-auto">
                            <option value="10">10</option>
                            <option value="25">25</option>
                            <option value="50">50</option>
                            <option value="100">100</option>
                        </select>
                        &nbsp;&nbsp;
                        <h6 class="mt-2"> @Localizer["entries"]</h6>
                    </div>
                </div>
            </div>
            <div class="col-lg-2 col-md-2"></div>
            <div class="col-lg-5 col-md-5 col-12 mt-lg-0 mt-md-0 mt-3">
                <nav aria-label="Page navigation example">
                    <div id="table_id_length">

                        <div id="custom-pagination" class=" d-flex text-center text-lg-end justify-content-end  text-end float-end">
                            <ul class="pagination justify-content-lg-end justify-content-md-end justify-content-center">
                                <li class="page-item disabled">
                                    <button class="page-link" href="#" aria-label="Previous" data-page="0"> <span aria-hidden="true">&laquo;</span></button>
                                </li>
                                <li class="page-item active"><button class="page-link" href="#" data-page="1">1</button></li>

                                <li class="page-item "><button class="page-link" href="#" data-page="2" aria-label="Next">  <span aria-hidden="true">&raquo;</span></button></li>

                            </ul>
                        </div>
                    </div>
                </nav>
            </div>
        </div>
        <!-- end Pagination-->
    </div>
</div>
<script>
    $(document).ready(function () {
        $('#dataTable').DataTable();

        var url = window.location.href;
        var urlParams = new URLSearchParams(window.location.search);
        var tab = urlParams.get('tab');
    });
    myFunction();
    $('#table_length_select').change();

    function Cancel() {
        $("#addSubscription").modal("hide");
    }

    function clienttab() {
        var tab = "Insurance";
        $('#enquiry-tab').attr('aria-selected', 'false');
        $('#client-tab').attr('aria-selected', 'true');
        $('#claim-tab').attr('aria-selected', 'false');
        $('#general-tab').attr('aria-selected', 'false');

        $('#enquiry-tab').attr('class', 'nav-link');
        $('#client-tab').attr('class', 'nav-link active');
        $('#claim-tab').attr('class', 'nav-link');
        $('#general-tab').attr('class', 'nav-link');

        $.ajax({
            url: '/SentEmail/Tab?tab=' + tab, // Controller action URL
            type: 'POST',             // HTTP method
            data: { tab: tab },      // Data to send (query parameter)
            success: function (response) {
                // Handle success - update the page dynamically
                console.log('Response:', response);
                $('#tabhead').css('display', 'contents');
                $('#tabhead1').css('display', 'none');
                $('#tabtable').html('');
                var htmltab = '';
                for (var i = 0; i < response.length; i++) {
                    htmltab += '<tr>';
                    htmltab += '<td>' + (i + 1) + '</td>';
                    let s_from = response[i].s_from.trim();
                    htmltab += '<td><a href="/SentClient?email=' + response[i].s_from + '&client=' + response[i].s_fromname + '&tab=' + tab + '">' + response[i].s_fromname + '</a></td>';
                    htmltab += '<td>' + response[i].s_sentdate + '</td>';
                    htmltab += '</tr>';
                }
                $('#tabtable').html(htmltab);

                // Example: Update a specific section with the response data
                $('#content-area').html(response);
            },
            error: function (xhr, status, error) {
                // Handle errors
                console.error('Error:', error);
            }
        });
    }

    function enquirytab() {
        var tab = "enquiry";
        $('#enquiry-tab').attr('aria-selected', 'true');
        $('#client-tab').attr('aria-selected', 'false');
        $('#claim-tab').attr('aria-selected', 'false');
        $('#general-tab').attr('aria-selected', 'false');

        $('#enquiry-tab').attr('class', 'nav-link active');
        $('#client-tab').attr('class', 'nav-link');
        $('#claim-tab').attr('class', 'nav-link');
        $('#general-tab').attr('class', 'nav-link');

        $.ajax({
            url: '/SentEmail/Tab?tab=' + tab, // Controller action URL
            type: 'POST',             // HTTP method
            data: { tab: tab },      // Data to send (query parameter)
            success: function (response) {
                // Handle success - update the page dynamically
                console.log('Response:', response);
                $('#tabhead').css('display', 'contents');
                $('#tabhead1').css('display', 'none');
                $('#tabtable').html('');
                var htmltab = '';
                for (var i = 0; i < response.length; i++) {
                    htmltab += '<tr>';
                    htmltab += '<td>' + (i + 1) + '</td>'; // Serial number
                    let s_from = response[i].s_from.trim();
                    htmltab += '<td><a href="/SentClient?email=' + response[i].s_from + '&client=' + response[i].s_fromname + '&tab=' + tab + '">' + response[i].s_fromname + '</a></td>';
                    htmltab += '<td>' + response[i].s_sentdate + '</td>';
                    htmltab += '</tr>';
                }
                $('#tabtable').html(htmltab);

                // Example: Update a specific section with the response data
                $('#content-area').html(response);
            },
            error: function (xhr, status, error) {
                // Handle errors
                console.error('Error:', error);
            }
        });
    }

    function claimtab() {
        var tab = "claim";
        $('#enquiry-tab').attr('aria-selected', 'false');
        $('#client-tab').attr('aria-selected', 'false');
        $('#claim-tab').attr('aria-selected', 'true');
        $('#general-tab').attr('aria-selected', 'true');

        $.ajax({
            url: '/SentEmail/Tab?tab=' + tab, // Controller action URL
            type: 'POST',             // HTTP method
            data: { tab: tab },      // Data to send (query parameter)
            success: function (response) {
                // Handle success - update the page dynamically
                console.log('Response:', response);
                $('#tabhead').css('display', 'contents');
                $('#tabhead1').css('display', 'none');
                $('#tabtable').html('');
                var htmltab = '';
                for (var i = 0; i < response.length; i++) {
                    htmltab += '<tr>';
                    htmltab += '<td>' + (i + 1) + '</td>'; // Serial number
                    let s_from = response[i].s_from.trim();
                    htmltab += '<td><a href="/SentClient?email=' + response[i].s_from + '&client=' + response[i].s_fromname + '&tab=' + tab + '">' + response[i].s_fromname + '</a></td>';
                    htmltab += '<td>' + response[i].s_sentdate + '</td>';
                    htmltab += '</tr>';
                }
                $('#tabtable').html(htmltab);

                // Example: Update a specific section with the response data
                $('#content-area').html(response);
            },
            error: function (xhr, status, error) {
                // Handle errors
                console.error('Error:', error);
            }
        });
    }

    function generaltab() {
        var tab = "General";
        $('#enquiry-tab').attr('aria-selected', 'false');
        $('#client-tab').attr('aria-selected', 'false');
        $('#claim-tab').attr('aria-selected', 'false');
        $('#general-tab').attr('aria-selected', 'true');

        $.ajax({
            url: '/SentEmail/general?tab=' + tab, // Controller action URL
            type: 'POST',             // HTTP method
            data: { tab: tab },      // Data to send (query parameter)
            success: function (response) {
                // Handle success - update the page dynamically
                console.log('Response:', response);
                $('#tabhead').css('display', 'none');
                $('#tabhead1').css('display', 'contents');
                $('#tabtable').html('');
                var htmltab = '';
                for (var i = 0; i < response.length; i++) {
                    htmltab += '<tr>';
                    htmltab += '<td>' + (i + 1) + '</td>';
                    htmltab += '<td style="display:none">' + response[i].s_id + '</td>';
                    htmltab += '<td>' + response[i].s_from + '</td>';
                    htmltab += '<td>' + response[i].s_to + '</td>';
                    htmltab += '<td>' + response[i].s_subject + '</td>';
                    htmltab += '<td>' + response[i].s_sentdate + '</td>';
                    htmltab += '<td><i class="fas fa-eye text-primary" onclick="inboxmsg(' + response[i].s_id + ')"></i></td>';
                    htmltab += '</tr>';
                }
                $('#tabtable').html(htmltab);

                // Example: Update a specific section with the response data
                $('#content-area').html(response);
            },
            error: function (xhr, status, error) {
                // Handle errors
                console.error('Error:', error);
            }
        });
    }

    function inboxmsg(id) {


        // Show the modal
        $("#addSubscription").modal("show");

        // Data payload for the request
        var data = { id: id };

        // Perform AJAX POST request
        $.ajax({
            url: '/SentEmail/showdetails', // Controller action URL
            type: 'POST',                   // HTTP method
            data: data,                     // Data to send
            success: function (response) {
                console.log(response);

                if (response) {

                    if (response.s_attachment != "No attachments available.") {
                        // const fileName = response.s_attachment.split(/[/\\]/).pop();



                        // $('#filename').text(fileName);

                        // const buttons1 = `<a href="" title="View PDF" onclick="viewfile()"><i class="fas fa-eye" style="font-size: 16px; color: blue;"></i></a>`;
                        // const buttons2 = `<a href="${response.s_attachment}" title="Download PDF" onclick="downloadfile()"><i class="fa-solid fa-chevron-down" style="font-size: 16px; color: black;"></i></a>`;

                        // $('#filebuttons1').html(buttons1);
                        // $('#filebuttons1').val(response.s_attachment);
                        // $('#filebuttons2').html(buttons2);
                        // $('#filebuttons2').val(response.s_attachment);
                        // $('#attachdiv').show();



                        //                 // Sample response.s_attachment data
                        //                 const attachments = response.s_attachment;

                        //                 // Split and process each attachment path
                        //                 const attachmentArray = attachments.trim().split('\n');

                        //                 // Generate the HTML
                        //                 let attachmentHTML = '';
                        //                 attachmentArray.forEach((attachmentPath) => {
                        //                     const fileName = attachmentPath.split(/[/\\]/).pop(); // Extract the filename
                        //                     attachmentHTML += `
                        //     <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; border: 1px solid black; padding: 5px;">
                        //         <span style="flex: 1;">${fileName}</span>
                        //         <a href="${attachmentPath.trim()}" title="Download ${fileName}" style="flex: 0;">
                        //             <i class="fa-solid fa-chevron-down" style="font-size: 16px; color: black;"></i>
                        //         </a>
                        //     </div>
                        // `;
                        //                 });

                        //                 // Insert the generated HTML into a container
                        //                 document.getElementById('attachdiv').innerHTML = attachmentHTML;

                        //                 // Show the attachment container
                        //                 document.getElementById('attachdiv').style.display = 'block';


                        // Sample response.s_attachment data
                        const attachments = response.s_attachment;

                        // Split and process each attachment path
                        const attachmentArray = attachments.trim().split('\n');

                        // Generate the HTML
                        let attachmentHTML = '';
                        attachmentArray.forEach((attachmentPath) => {
                            const fileName = attachmentPath.split(/[/\\]/).pop(); // Extract the filename
                            const trimmedPath = attachmentPath.trim(); // Trim to remove newline or extra spaces
                            const safeAttachmentPath = trimmedPath.replace(/\\/g, '/');
                            //                     attachmentHTML += `
                            // <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; border: 1px solid black; padding: 5px;">
                            //     <!-- Button for filename -->
                            //     <button style="flex: 1; background-color: #f0f0f0; border: 1px solid black; padding: 5px; cursor: default;">
                            //         ${fileName}
                            //     </button>
                            //     <!-- Button for download -->
                            //     <button style="flex: 0; background-color: #e0e0e0; border: 1px solid black; padding: 5px; cursor: pointer;" onclick="window.open('${attachmentPath.trim()}', '_blank')">
                            //         Download
                            //     </button>
                            // </div>
                            // `;
                            const name = "hello";
                            attachmentHTML += `
                    <div class="attachments">
                    <!-- Button for filename -->
                        <button style = "display: inline-block; padding: 8px;">
                        ${fileName}
                    </button>
                    <!-- Button for download -->
                                                        <button  style = "display: inline-block; height: 42px; width: auto;" onclick="downloadfile('${safeAttachmentPath}')">
                             <i class="fa-solid fa-chevron-down" style="font-size: 16px; color: black;"></i>
                    </button>
                </div>
                `;
                        });

                        // Insert the generated HTML into a container
                        document.getElementById('attachdiv').innerHTML = attachmentHTML;

                        // Show the attachment container
                        document.getElementById('attachdiv').style.display = 'block';

                    } else {
                        $('#attachdiv').hide();
                    }


                    $('#sc_tolabel').text(response.s_to || 'N/A');
                    $('#sc_fromlabel').text(response.s_from || 'N/A');
                    $('#sc_subjectlabel').text(response.s_subject || 'N/A');

                    const formattedBody = (response.s_body || '').replace(/<br\s*\/?>/gi, "\n").replace(/<\/?[^>]+(>|$)/g, "");
                    $('#sc_bodylabel').val(formattedBody);






                    // Optional: Update a specific content area with additional information
                    $('#content-area').html(response.content || 'No content available.');


                    $.ajax({
                        url: '/SentEmail/inboxdates', // Controller action URL
                        type: 'POST',                   // HTTP method
                        data: data,                     // Data to send
                        success: function (response) {
                            console.log(response);
                            // $('#date1').show();
                            // $('#date2').show();
                            // $('#date3').show();

                            // for (var i = 0; i < response.length; i++) {
                            //     if (response.length == "1") {
                            //         const date1 = response[0].s_sentdate;
                            //         $('#date1').val(response[0].s_id);
                            //         $('#date1').attr('onclick', `inboxmsg('${response[0].s_id}')`);
                            //         $('#date1').text(date1);
                            //         $('#date2').hide();
                            //         $('#date3').hide();
                            //     }
                            //     else {
                            //         const date1 = response[0].s_sentdate;
                            //         const date2 = response[1].s_sentdate;
                            //         const date3 = response[2].s_sentdate;

                            //         $('#date1').val(response[0].s_id);
                            //         $('#date2').val(response[1].s_id);
                            //         $('#date3').val(response[2].s_id);


                            //         $('#date1').attr('onclick', `inboxmsg('${response[0].s_id}')`);
                            //         $('#date2').attr('onclick', `inboxmsg('${response[1].s_id}')`);
                            //         $('#date3').attr('onclick', `inboxmsg('${response[2].s_id}')`);



                            //         $('#date1').text(date1);
                            //         $('#date2').text(date2);
                            //         $('#date3').text(date3);
                            //         break;
                            //     }
                            // }


                            $('#arrow-container').empty();

                            // Iterate through the response and dynamically create elements
                            response.forEach((item, index) => {
                                const date = item.s_sentdate; // Get the date
                                const id = item.s_id; // Get the ID

                                // Create a new arrow div
                                const arrowDiv = $(`<div class="arrow-item" id="date${index + 1}" onclick="inboxmsg('${id}')">${date}</div>`);

                                // Append the arrow div to the container
                                $('#arrow-container').append(arrowDiv);

                                // Add spacing if needed
                                $('#arrow-container').append('<div style="padding:12px"></div>');
                            });






                            // Optional: Update a specific content area with additional information
                            $('#content-area').html(response.content || 'No content available.');







                        },
                        error: function (xhr, status, error) {
                            // Display error notification
                            console.error('Error:', error);
                            alert('An error occurred while fetching the message details. Please try again later.');
                        }
                    });



                } else {
                    console.error('Empty response received');
                    alert('No data available.');
                }
            },
            error: function (xhr, status, error) {
                // Display error notification
                console.error('Error:', error);
                alert('An error occurred while fetching the message details. Please try again later.');
            }
        });
    }

    // function downloadfile(filePath) {
    //   //  const filePath = $('#filebuttons2').val();

    //     // Encode the file path to make it safe for URLs
    //     const encodedPath = encodeURIComponent(filePath);

    //     // Construct the URL to call the controller
    //     const url = `/SentClient/DownloadFile?filePath=${filePath}`;

    //     // Open the file in a new tab or start downloading
    //     window.open(url, "_blank");
    // }

    function downloadfile(filePath) {
        console.log("Original File Path:", filePath); // Log the input

        try {
            // Trim and encode the file path
            const trimmedPath = filePath.trim();
            const encodedPath = encodeURIComponent(trimmedPath);
            console.log("Encoded File Path:", encodedPath); // Log the encoded path

            // Construct the URL
            const url = `/SentClient/DownloadFile?filePath=${encodedPath}`;
            console.log("Download URL:", url); // Log the final URL

            // Open the file in a new tab
            window.open(url, "_blank");
        } catch (error) {
            console.error("Error during file download:", error); // Log any errors
        }
    }
    // function downloadfile(filePath) {
    //     console.log("Original File Path:", filePath); // Log the input

    //     try {
    //         // Trim and encode the file path
    //         const trimmedPath = filePath.trim();
    //         const encodedPath = encodeURIComponent(trimmedPath);
    //         console.log("Encoded File Path:", encodedPath); // Log the encoded path

    //         // Construct the URL
    //         const url = `/SentClient/DownloadFile?filePath=${encodedPath}`;
    //         console.log("Download URL:", url); // Log the final URL

    //         // Test if the URL is accessible
    //         fetch(url, { method: 'HEAD' })
    //             .then((response) => {
    //                 if (response.ok) {
    //                     console.log("File is available for download.");
    //                     window.open(url, "_blank"); // Download the file
    //                 } else {
    //                     console.error(`Error: Server responded with status ${response.status}`);
    //                 }
    //             })
    //             .catch((error) => {
    //                 console.error("Error testing file availability:", error);
    //             });
    //     } catch (error) {
    //         console.error("Error during file download:", error); // Log any errors
    //     }
    // }





    function viewfile() {
        const filePath = $('#filebuttons1').val();

        // Encode the file path to make it safe for URLs
        const encodedPath = encodeURIComponent(filePath);

        // Construct the URL to call the controller
        const url = `/SentClient/ViewFile?filePath=${encodedPath}`;

        // Open the file in a new tab or start downloading
        window.open(url, "_blank");
    }

    // function downloadfile(filename) {
    // // Remove any unwanted whitespace or line breaks from the filePath
    // const cleanedFilePath = filePath.trim();

    // // Encode the file path to make it safe for URLs
    // const encodedPath = encodeURIComponent(cleanedFilePath);

    // // Construct the URL to call the controller
    // const url = `/SentClient/DownloadFile?filePath=${encodedPath}`;

    // // Open the file in a new tab or start downloading
    // window.open(url, "_blank");

    // console.log("Download URL:", url); // Debugging

    //   alert("hello");
    //}



    function filter() {
        $("#addfilter").modal("show");
    }
    function submitfilter() {
        $("#addfilter").modal("hide");
        var from = $('#s_from').val();
        var to = $('#s_to').val();
        var subject = $('#s_subject').val();
        var hasthewords = $('#s_hasthewords').val();
        var tab = $('#s_tab').val();


        $('#enquiry-tab').attr('aria-selected', 'false');
        $('#client-tab').attr('aria-selected', 'false');
        $('#claim-tab').attr('aria-selected', 'false');
        $('#general-tab').attr('aria-selected', 'false');


        $('#enquiry-tab').attr('class', 'nav-link');
        $('#client-tab').attr('class', 'nav-link');
        $('#claim-tab').attr('class', 'nav-link');
        $('#general-tab').attr('class', 'nav-link');

        $('#' + tab + '-tab').attr('aria-selected', 'true');
        $('#' + tab + '-tab').attr('class', 'nav-link active');


        if (tab == 'client') {
            tab = "insurance";
        }

        if (tab != 'general') {
            var data = {
                from: from,
                to: to,
                subject: subject,
                hasthewords: hasthewords,
                tab: tab,

            };

            $.ajax({
                url: '/SentEmail/filter?from=' + from + 'to=' + to + 'subject' + subject + 'hasthewords=' + hasthewords + 'tab=' + tab, // Controller action URL
                type: 'POST',             // HTTP method
                data: data,      // Data to send (query parameter)
                success: function (response) {
                    // Handle success - update the page dynamically
                    console.log('Response:', response);
                    $('#tabhead').css('display', 'contents');
                    $('#tabhead1').css('display', 'none');
                    $('#tabtable').html('');
                    var htmltab = '';
                    for (var i = 0; i < response.length; i++) {
                        htmltab += '<tr>';
                        htmltab += '<td>' + (i + 1) + '</td>'; // Serial number
                        let s_from = response[i].s_from.trim();
                        htmltab += '<td><a href="/SentClient?email=' + response[i].s_from + '&client=' + response[i].s_fromname + '&tab=' + tab + '">' + response[i].s_fromname + '</a></td>';
                        htmltab += '<td>' + response[i].s_sentdate + '</td>';
                        htmltab += '</tr>';
                    }
                    $('#tabtable').html(htmltab);

                    // Example: Update a specific section with the response data
                    $('#content-area').html(response);
                },
                error: function (xhr, status, error) {
                    // Handle errors
                    console.error('Error:', error);
                }
            });

        }
        else {

            var data = {
                from: from,
                to: to,
                subject: subject,
                hasthewords: hasthewords,
                tab: tab,

            };

            $.ajax({
                url: '/SentEmail/Generalfilter?from=' + from + 'to=' + to + 'subject' + subject + 'hasthewords=' + hasthewords + 'tab=' + tab, // Controller action URL
                type: 'POST',             // HTTP method
                data: data,      // Data to send (query parameter)
                success: function (response) {
                    // Handle success - update the page dynamically
                    console.log('Response:', response);
                    $('#tabhead').css('display', 'none');
                    $('#tabhead1').css('display', 'contents');
                    $('#tabtable').html('');
                    var htmltab = '';
                    for (var i = 0; i < response.length; i++) {
                        htmltab += '<tr>';
                        htmltab += '<td>' + (i + 1) + '</td>'; // Serial number
                        let s_from = response[i].s_from.trim();
                        htmltab += '<td>' + response[i].s_fromname + '</a></td>';
                        htmltab += '<td>' + response[i].s_to + '</a></td>';
                        htmltab += '<td>' + response[i].s_subject + '</td>';
                        htmltab += '<td>' + response[i].s_sentdate + '</td>';
                        htmltab += '<td><i class="fas fa-eye text-primary" onclick="inboxmsg(' + response[i].s_id + ')"></i></td>';
                        htmltab += '</tr>';
                    }
                    $('#tabtable').html(htmltab);

                    // Example: Update a specific section with the response data
                    $('#content-area').html(response);
                },
                error: function (xhr, status, error) {
                    // Handle errors
                    console.error('Error:', error);
                }
            });

        }
    }

    function addorder() {
        window.location.href = "/SentEmail/Index";
    }

</script>
